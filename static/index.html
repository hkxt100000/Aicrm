<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â§©Âè∑ÂüéCRM - ÂÆ¢Êà∑ÂÖ≥Á≥ªÁÆ°ÁêÜÁ≥ªÁªü</title>
    <link rel="stylesheet" href="/static/style.css?v=20260126022">
    <link rel="stylesheet" href="/static/tag-selection-styles.css?v=20260125006">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

</head>
<body>
    <div class="app-container">
        <!-- ‰æßËæπÊ†è -->
        <aside class="sidebar" id="sidebar">
            <!-- LogoÂå∫Âüü -->
            <div class="sidebar-logo">
                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #FF6B1A 0%, #E65100 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 18px;">Â§©</div>
                <span class="sidebar-logo-text">Â§©Âè∑ÂüéCRM</span>
            </div>
            
            <!-- ÂØºËà™ËèúÂçï -->
            <nav class="sidebar-nav">
                <a href="#" class="nav-item" data-module="dashboard">
                    <i class="fas fa-th-large"></i>
                    <span>Â∑•‰ΩúÂè∞</span>
                </a>
                
                <!-- ÂÆ¢Êà∑ÁÆ°ÁêÜ -->
                <div class="nav-group">
                    <a href="#" class="nav-item nav-group-toggle" onclick="toggleNavGroup(event, 'customer-manage')">
                        <i class="fas fa-users"></i>
                        <span>ÂÆ¢Êà∑ÁÆ°ÁêÜ</span>
                        <i class="fas fa-chevron-down nav-arrow"></i>
                    </a>
                    <div class="nav-group-content" id="nav-customer-manage">
                        <a href="#" class="nav-item nav-sub-item" data-module="customers">
                            <i class="fas fa-list"></i>
                            <span>ÂÆ¢Êà∑ÂàóË°®</span>
                        </a>
                        <a href="#" class="nav-item nav-sub-item" data-module="customer-profile">
                            <i class="fas fa-user-circle"></i>
                            <span>ÂÆ¢Êà∑ÁîªÂÉè</span>
                        </a>
                        <a href="#" class="nav-item nav-sub-item" data-module="enterprise-tags">
                            <i class="fas fa-tag"></i>
                            <span>‰ºÅ‰∏öÊ†áÁ≠æ</span>
                        </a>
                        <a href="#" class="nav-item nav-sub-item" data-module="enterprise-contacts">
                            <i class="fas fa-address-book"></i>
                            <span>‰ºÅ‰∏öÈÄöËÆØÂΩï</span>
                        </a>
                    </div>
                </div>
                
                <!-- ÂÆ¢Êà∑Áæ§ÁÆ°ÁêÜ -->
                <div class="nav-group">
                    <a href="#" class="nav-item nav-group-toggle" onclick="toggleNavGroup(event, 'customer-groups')">
                        <i class="fas fa-user-friends"></i>
                        <span>ÂÆ¢Êà∑Áæ§ÁÆ°ÁêÜ</span>
                        <i class="fas fa-chevron-down nav-arrow"></i>
                    </a>
                    <div class="nav-group-content" id="nav-customer-groups">
                        <a href="#" class="nav-item nav-sub-item" data-module="customer-groups">
                            <i class="fas fa-list-ul"></i>
                            <span>ÂÆ¢Êà∑Áæ§ÂàóË°®</span>
                        </a>
                        <a href="#" class="nav-item nav-sub-item" data-module="group-tags">
                            <i class="fas fa-tags"></i>
                            <span>ÂÆ¢Êà∑Áæ§Ê†áÁ≠æ</span>
                        </a>
                    </div>
                </div>
                
                <!-- ÂÆ¢Êà∑ËøêËê• -->
                <div class="nav-group">
                    <a href="#" class="nav-item nav-group-toggle" onclick="toggleNavGroup(event, 'customer-ops')">
                        <i class="fas fa-bullhorn"></i>
                        <span>ÂÆ¢Êà∑ËøêËê•</span>
                        <i class="fas fa-chevron-down nav-arrow"></i>
                    </a>
                    <div class="nav-group-content" id="nav-customer-ops">
                        <a href="#" class="nav-item nav-sub-item" data-module="welcome-msg">
                            <i class="fas fa-hand-paper"></i>
                            <span>Ê¨¢ËøéËØ≠ËÆæÁΩÆ</span>
                        </a>
                        <a href="#" class="nav-item nav-sub-item" data-module="customer-broadcast">
                            <i class="fas fa-paper-plane"></i>
                            <span>ÂÆ¢Êà∑Áæ§Âèë</span>
                        </a>
                        <a href="#" class="nav-item nav-sub-item" data-module="moments-publish">
                            <i class="fas fa-share-alt"></i>
                            <span>ÂèëÊúãÂèãÂúà</span>
                        </a>
                        <a href="#" class="nav-item nav-sub-item" data-module="moments-record">
                            <i class="fas fa-history"></i>
                            <span>ÊúãÂèãÂúàËÆ∞ÂΩï</span>
                        </a>
                    </div>
                </div>
                
                <!-- ÂÆ¢Êà∑Áæ§ËøêËê• -->
                <div class="nav-group">
                    <a href="#" class="nav-item nav-group-toggle" onclick="toggleNavGroup(event, 'group-ops')">
                        <i class="fas fa-comments"></i>
                        <span>ÂÆ¢Êà∑Áæ§ËøêËê•</span>
                        <i class="fas fa-chevron-down nav-arrow"></i>
                    </a>
                    <div class="nav-group-content" id="nav-group-ops">
                        <a href="#" class="nav-item nav-sub-item" data-module="group-welcome">
                            <i class="fas fa-door-open"></i>
                            <span>ËøõÁæ§Ê¨¢ËøéËØ≠</span>
                        </a>
                        <a href="#" class="nav-item nav-sub-item" data-module="group-broadcast">
                            <i class="fas fa-broadcast-tower"></i>
                            <span>ÂÆ¢Êà∑Áæ§Áæ§Âèë</span>
                        </a>
                    </div>
                </div>
                
                <!-- ‰ºÅÂæÆÊú∫Âô®‰∫∫ -->
                <div class="nav-group">
                    <a href="#" class="nav-item nav-group-toggle" onclick="toggleNavGroup(event, 'wecom-bot')">
                        <i class="fas fa-robot"></i>
                        <span>‰ºÅÂæÆÊú∫Âô®‰∫∫</span>
                        <i class="fas fa-chevron-down nav-arrow"></i>
                    </a>
                    <div class="nav-group-content" id="nav-wecom-bot">
                        <a href="#" class="nav-item nav-sub-item" data-module="supplier-notify">
                            <i class="fas fa-bell"></i>
                            <span>‰æõÂ∫îÂïÜÈÄöÁü•Áæ§</span>
                        </a>
                        <a href="#" class="nav-item nav-sub-item" data-module="agent-notify">
                            <i class="fas fa-bullhorn"></i>
                            <span>‰ª£ÁêÜÂïÜÈÄöÁü•Áæ§</span>
                        </a>
                    </div>
                </div>
                
                <!-- Â§©Âè∑ÂüéÊï∞ÊçÆ -->
                <div class="nav-group">
                    <a href="#" class="nav-item nav-group-toggle" onclick="toggleNavGroup(event, 'tianhao-data')">
                        <i class="fas fa-chart-line"></i>
                        <span>Â§©Âè∑ÂüéÊï∞ÊçÆ</span>
                        <i class="fas fa-chevron-down nav-arrow"></i>
                    </a>
                    <div class="nav-group-content" id="nav-tianhao-data">
                        <a href="#" class="nav-item nav-sub-item" data-module="order-data">
                            <i class="fas fa-shopping-cart"></i>
                            <span>ËÆ¢ÂçïÊï∞ÊçÆ</span>
                        </a>
                        <a href="#" class="nav-item nav-sub-item" data-module="supplier-data">
                            <i class="fas fa-truck"></i>
                            <span>‰æõÂ∫îÂïÜÊï∞ÊçÆ</span>
                        </a>
                        <a href="#" class="nav-item nav-sub-item" data-module="product-data">
                            <i class="fas fa-box"></i>
                            <span>‰∫ßÂìÅÊï∞ÊçÆ</span>
                        </a>
                        <a href="#" class="nav-item nav-sub-item" data-module="agent-data">
                            <i class="fas fa-users"></i>
                            <span>‰ª£ÁêÜÂïÜÊï∞ÊçÆ</span>
                        </a>
                        <a href="#" class="nav-item nav-sub-item" data-module="finance-data">
                            <i class="fas fa-dollar-sign"></i>
                            <span>Ë¥¢Âä°Êï∞ÊçÆ</span>
                        </a>
                        <a href="#" class="nav-item nav-sub-item" data-module="business-data">
                            <i class="fas fa-briefcase"></i>
                            <span>ÂïÜÂä°Êï∞ÊçÆ</span>
                        </a>
                    </div>
                </div>
                
                <a href="#" class="nav-item active" data-module="spreadsheet">
                    <i class="fas fa-table"></i>
                    <span>‰ºÅÂæÆÊô∫ËÉΩË°®</span>
                </a>
                <a href="#" class="nav-item" data-module="promoter">
                    <i class="fas fa-user-plus"></i>
                    <span>Êé®ÂÆ¢ÁÆ°ÁêÜ</span>
                </a>
                <a href="#" class="nav-item" data-module="settings">
                    <i class="fas fa-cog"></i>
                    <span>Á≥ªÁªüËÆæÁΩÆ</span>
                </a>
            </nav>
            
            <!-- Áî®Êà∑‰ø°ÊÅØ -->
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">ÁÆ°</div>
                    <div class="user-details">
                        <div class="user-name">ÁÆ°ÁêÜÂëò</div>
                        <div class="user-role">Á≥ªÁªüÁÆ°ÁêÜÂëò</div>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
        <div class="main-wrapper">
            <!-- È°∂ÈÉ®Header -->
            <header class="main-header">
                <div class="header-left">
                    <button class="btn-icon" id="btn-menu-toggle" style="display: none;">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="breadcrumb">
                        <a href="#" class="breadcrumb-item">È¶ñÈ°µ</a>
                        <span>/</span>
                        <span class="breadcrumb-item active" id="breadcrumb-current">Êô∫ËÉΩË°®Ê†º</span>
                    </div>
                </div>
                <div class="header-right">
                    <!-- È°∂ÈÉ®ÈÖçÁΩÆÊåâÈíÆÂ∑≤Âà†Èô§ÔºåÈÖçÁΩÆÂäüËÉΩÁßªËá≥"Á≥ªÁªüÈÖçÁΩÆ"Ê®°Âùó -->
                </div>
            </header>
            
            <!-- ‰∏ªÂÜÖÂÆπ -->
            <main class="main-content">
                <!-- Â∑•‰ΩúÂè∞Ê®°Âùó -->
                <section id="module-dashboard" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-th-large"></i>
                            Â∑•‰ΩúÂè∞
                        </h1>
                    </div>
                    
                    <div class="empty-state" style="padding: 100px 20px; text-align: center;">
                        <div style="font-size: 64px; opacity: 0.3; margin-bottom: 20px;">üöß</div>
                        <h3 style="color: var(--grey-700); margin-bottom: 10px;">ÂäüËÉΩÂºÄÂèë‰∏≠</h3>
                        <p style="color: var(--grey-500);">Â∑•‰ΩúÂè∞ÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠ÔºåÊï¨ËØ∑ÊúüÂæÖ...</p>
                    </div>
                </section>
                
                <!-- ÂÆ¢Êà∑ÁÆ°ÁêÜÊ®°Âùó -->
                <section id="module-customers" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-users"></i>
                            ÂÆ¢Êà∑ÁÆ°ÁêÜ
                        </h1>
                        <div class="page-actions">
                            <div class="sync-buttons">
                                <button class="btn-sync btn-sync-incremental" onclick="syncCustomers(false)" title="‰ªÖÂêåÊ≠•Êñ∞Â¢ûÂíåÊúÄËøë6Â∞èÊó∂ÊúâÂèòÂåñÁöÑÂÆ¢Êà∑">
                                    <i class="fas fa-sync-alt"></i>
                                    Â¢ûÈáèÂêåÊ≠•
                                </button>
                                <button class="btn-sync btn-sync-full" onclick="syncCustomers(true)" title="ÂêåÊ≠•ÊâÄÊúâÂÆ¢Êà∑ÔºàËÄóÊó∂ËæÉÈïøÔºâ">
                                    <i class="fas fa-redo"></i>
                                    ÂÖ®ÈáèÂêåÊ≠•
                                </button>
                            </div>
                            <button class="btn btn-outlined" onclick="exportCustomers()">
                                <i class="fas fa-download"></i>
                                ÂØºÂá∫
                            </button>
                            <button class="btn btn-primary" onclick="addCustomer()">
                                <i class="fas fa-user-plus"></i>
                                Ê∑ªÂä†ÂÆ¢Êà∑
                            </button>
                        </div>
                    </div>
                    
                    <!-- Á≠õÈÄâÂå∫Âüü -->
                    <div class="card mb-6">
                        <div class="filter-container">
                            <!-- Á≠õÈÄâÊù°‰ª∂Ë°å -->
                            <div class="filter-row">
                                <div class="filter-item">
                                    <input type="text" class="filter-input" id="filter-search" placeholder="ÂÆ¢Êà∑‰ø°ÊÅØ">
                                </div>
                                <div class="filter-item">
                                    <select class="filter-select" id="filter-employee">
                                        <option value="">ÊâÄÂ±ûÂëòÂ∑•</option>
                                    </select>
                                </div>
                                <div class="filter-item">
                                    <select class="filter-select" id="filter-user-type">
                                        <option value="">Áî®Êà∑Â±ûÊÄß</option>
                                        <option value="Áî®Êà∑|ÂÆ¢Êà∑">Áî®Êà∑</option>
                                        <option value="‰ª£ÁêÜÂïÜ">‰ª£ÁêÜÂïÜ</option>
                                        <option value="Âêà‰ºô‰∫∫">Âêà‰ºô‰∫∫</option>
                                        <option value="‰æõÂ∫îÂïÜ">‰æõÂ∫îÂïÜ</option>
                                        <option value="ÂêåË°å">ÂêåË°å</option>
                                    </select>
                                </div>
                                <div class="filter-item">
                                    <select class="filter-select" id="filter-add-way">
                                        <option value="">Ê∑ªÂä†ÊñπÂºè</option>
                                        <option value="1">Áõ¥Êé•Ê∑ªÂä†</option>
                                        <option value="2">Êâ´Á†ÅÊ∑ªÂä†</option>
                                        <option value="3">ÊêúÁ¥¢Ê∑ªÂä†</option>
                                        <option value="4">ÂêçÁâáÂàÜ‰∫´</option>
                                    </select>
                                </div>
                                <div class="filter-item">
                                    <div class="filter-tag-select" onclick="showTagSelector()">
                                        <span id="selected-tags-display">‰ºÅ‰∏öÊ†áÁ≠æ</span>
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                </div>
                                <div class="filter-item">
                                    <input type="date" class="filter-input" id="filter-date-start" placeholder="ÂºÄÂßãÊó•Êúü">
                                </div>
                                <div class="filter-item">
                                    <input type="date" class="filter-input" id="filter-date-end" placeholder="ÁªìÊùüÊó•Êúü">
                                </div>
                                <div class="filter-item">
                                    <select class="filter-select" id="filter-gender">
                                        <option value="">ÊÄßÂà´</option>
                                        <option value="1">Áî∑</option>
                                        <option value="2">Â•≥</option>
                                        <option value="0">Êú™Áü•</option>
                                    </select>
                                </div>
                                <div class="filter-item">
                                    <div class="filter-tag-select" onclick="showProvinceSelector()">
                                        <span id="selected-province-display">ÁúÅ‰ªΩ</span>
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                </div>
                                
                                <!-- Âè≥‰æßÊìç‰ΩúÂå∫Âüü -->
                                <div class="filter-actions">
                                    <div id="filter-result-count" style="color: var(--grey-600); font-size: 13px; white-space: nowrap;">
                                        <!-- ÊòæÁ§∫Á≠õÈÄâÁªìÊûúÊï∞Èáè -->
                                    </div>
                                    <button class="btn btn-primary btn-sm" onclick="applyFilters()">
                                        <i class="fas fa-search"></i> Êü•ËØ¢
                                    </button>
                                    <button class="btn btn-outlined btn-sm" onclick="resetFilters()">
                                        <i class="fas fa-redo"></i> ÈáçÁΩÆ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÊâπÈáèÊìç‰Ωú -->
                    <div class="card mb-6" id="batch-actions" style="display: none;">
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <span style="color: var(--grey-700); font-size: 14px;">
                                Â∑≤ÈÄâÊã© <strong id="selected-count" style="color: var(--primary-main);">0</strong> ‰∏™ÂÆ¢Êà∑
                            </span>
                            <button class="btn btn-outlined btn-sm" onclick="batchUpdateOwner()">
                                <i class="fas fa-user-edit"></i>
                                ‰øÆÊîπË∑üËøõ‰∫∫
                            </button>
                            <button class="btn btn-outlined btn-sm" onclick="batchUpdateTags()">
                                <i class="fas fa-tags"></i>
                                ÊâπÈáèÊâìÊ†áÁ≠æ
                            </button>
                            <button class="btn btn-outlined btn-sm" onclick="batchSendMessage()">
                                <i class="fas fa-paper-plane"></i>
                                Áæ§ÂèëÊ∂àÊÅØ
                            </button>
                            <button class="btn btn-text btn-sm" onclick="cancelSelection()" style="margin-left: auto;">
                                ÂèñÊ∂àÈÄâÊã©
                            </button>
                        </div>
                    </div>
                    
                    <!-- ÂÆ¢Êà∑ÂàóË°® -->
                    <div class="table-container">
                        <table class="table" id="customers-table">
                            <thead>
                                <tr>
                                    <th width="50">
                                        <input type="checkbox" id="select-all" onchange="toggleSelectAll()" style="cursor: pointer;">
                                    </th>
                                    <th width="60">Áî®Êà∑Â§¥ÂÉè</th>
                                    <th width="120">Áî®Êà∑ÊòµÁß∞</th>
                                    <th width="150">Áî®Êà∑Â§áÊ≥®</th>
                                    <th width="120">ÊâÄÂ±ûÂëòÂ∑•</th>
                                    <th width="120">ÊâÄÂ±ûÁæ§</th>
                                    <th width="60">ÊÄßÂà´</th>
                                    <th width="150">ÂÆ¢Êà∑Ê†áÁ≠æ</th>
                                    <th width="150">Ê∑ªÂä†Êó∂Èó¥</th>
                                    <th width="100">Ë∑üËøõÁä∂ÊÄÅ</th>
                                    <th width="150">Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="customer-table-body">
                                <tr>
                                    <td colspan="11" style="text-align: center; padding: 60px 0; color: var(--grey-500);">
                                        <i class="fas fa-users" style="font-size: 48px; margin-bottom: 16px; display: block; opacity: 0.3;"></i>
                                        <p style="font-size: 16px; margin-bottom: 8px;">ÊöÇÊó†ÂÆ¢Êà∑Êï∞ÊçÆ</p>
                                        <p style="font-size: 14px; color: var(--grey-400);">ÁÇπÂáªÂè≥‰∏äËßí"ÂêåÊ≠•ÂÆ¢Êà∑"ÊåâÈíÆ‰ªé‰ºÅ‰∏öÂæÆ‰ø°ÂêåÊ≠•ÂÆ¢Êà∑Êï∞ÊçÆ</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- ÂàÜÈ°µ -->
                    <div class="card" style="margin-top: 24px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px;">
                            <div style="color: var(--grey-600); font-size: 14px;">
                                ÂÖ± <strong id="total-count" style="color: var(--grey-900);">0</strong> Êù°ËÆ∞ÂΩï
                            </div>
                            <div style="display: flex; align-items: center; gap: 16px;">
                                <button class="btn btn-outlined btn-sm" onclick="changePage(-1)" id="btn-prev-page">
                                    <i class="fas fa-chevron-left"></i>
                                    ‰∏ä‰∏ÄÈ°µ
                                </button>
                                <span style="color: var(--grey-700); font-size: 14px;">
                                    Á¨¨ <strong id="current-page" style="color: var(--primary-main);">1</strong> È°µ / 
                                    ÂÖ± <strong id="total-pages" style="color: var(--grey-900);">1</strong> È°µ
                                </span>
                                <button class="btn btn-outlined btn-sm" onclick="changePage(1)" id="btn-next-page">
                                    ‰∏ã‰∏ÄÈ°µ
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- ÂÆ¢Êà∑ÁîªÂÉèÊ®°Âùó -->
                <section id="module-customer-profile" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-chart-pie"></i>
                            ÂÆ¢Êà∑ÁîªÂÉèÂàÜÊûê
                        </h1>
                        <div class="page-actions">
                            <button class="btn btn-primary" onclick="refreshCustomerPortrait()">
                                <i class="fas fa-sync-alt"></i> Âà∑Êñ∞Êï∞ÊçÆ
                            </button>
                        </div>
                    </div>
                    
                    <!-- Ê®°Âùó1ÔºöÊ†áÁ≠æÁª¥Â∫¶ÁªüËÆ° -->
                    <div class="portrait-section" style="padding: 24px; background: #F9FAFB;">
                        
                        <!-- 1.1 ÈáçÁÇπÊ†áÁ≠æÁªüËÆ° -->
                        <div style="margin-bottom: 24px;">
                            <h2 style="font-size: 18px; font-weight: 700; color: #212B36; margin-bottom: 20px; letter-spacing: -0.5px;">
                                Ê†∏ÂøÉÊ†áÁ≠æÁªüËÆ°
                            </h2>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                                <div class="stat-card-minimal" id="stat-user" onclick="showCustomersByTag('user', 'Áî®Êà∑Ê†áÁ≠æ')" style="cursor: pointer;">
                                    <div class="stat-icon-minimal" style="background: rgba(0, 184, 217, 0.12);">
                                        <i class="fas fa-user" style="color: #00B8D9;"></i>
                                    </div>
                                    <div class="stat-content-minimal">
                                        <div class="stat-label-minimal">Áî®Êà∑Ê†áÁ≠æ</div>
                                        <div class="stat-value-minimal">-</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card-minimal" id="stat-agent" onclick="showCustomersByTag('agent', '‰ª£ÁêÜÂïÜ')" style="cursor: pointer;">
                                    <div class="stat-icon-minimal" style="background: rgba(255, 171, 0, 0.12);">
                                        <i class="fas fa-handshake" style="color: #FFAB00;"></i>
                                    </div>
                                    <div class="stat-content-minimal">
                                        <div class="stat-label-minimal">‰ª£ÁêÜÂïÜ</div>
                                        <div class="stat-value-minimal">-</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card-minimal" id="stat-partner" onclick="showCustomersByTag('partner', 'Âêà‰ºô‰∫∫')" style="cursor: pointer;">
                                    <div class="stat-icon-minimal" style="background: rgba(94, 53, 177, 0.12);">
                                        <i class="fas fa-users-cog" style="color: #5E35B1;"></i>
                                    </div>
                                    <div class="stat-content-minimal">
                                        <div class="stat-label-minimal">Âêà‰ºô‰∫∫</div>
                                        <div class="stat-value-minimal">-</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card-minimal" id="stat-supplier" onclick="showCustomersByTag('supplier', '‰æõÂ∫îÂïÜ')" style="cursor: pointer;">
                                    <div class="stat-icon-minimal" style="background: rgba(54, 179, 126, 0.12);">
                                        <i class="fas fa-truck" style="color: #36B37E;"></i>
                                    </div>
                                    <div class="stat-content-minimal">
                                        <div class="stat-label-minimal">‰æõÂ∫îÂïÜ</div>
                                        <div class="stat-value-minimal">-</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card-minimal" id="stat-peer" onclick="showCustomersByTag('peer', 'ÂêåË°å')" style="cursor: pointer;">
                                    <div class="stat-icon-minimal" style="background: rgba(255, 86, 48, 0.12);">
                                        <i class="fas fa-briefcase" style="color: #FF5630;"></i>
                                    </div>
                                    <div class="stat-content-minimal">
                                        <div class="stat-label-minimal">ÂêåË°å</div>
                                        <div class="stat-value-minimal">-</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card-minimal" id="stat-old-agent" onclick="showCustomersByTag('old-agent', 'ÂéüÊúâËÄÅ‰ª£ÁêÜ')" style="cursor: pointer;">
                                    <div class="stat-icon-minimal" style="background: rgba(99, 115, 129, 0.12);">
                                        <i class="fas fa-history" style="color: #637381;"></i>
                                    </div>
                                    <div class="stat-content-minimal">
                                        <div class="stat-label-minimal">ÂéüÊúâËÄÅ‰ª£ÁêÜ</div>
                                        <div class="stat-value-minimal">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 1.2 ÁúÅ‰ªΩÊ†áÁ≠æÁªüËÆ° -->
                        <div style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 0 2px 0 rgba(145, 158, 171, 0.2), 0 12px 24px -4px rgba(145, 158, 171, 0.12); margin-bottom: 24px;">
                            <h3 style="margin: 0 0 20px 0; font-size: 15px; font-weight: 700; color: #212B36; letter-spacing: -0.5px;">
                                Âú∞ÂüüÂàÜÂ∏É
                            </h3>
                            <div id="province-list" style="display: flex; flex-wrap: wrap; gap: 10px;">
                                <div style="color: #637381; padding: 20px; font-size: 14px;">Âä†ËΩΩ‰∏≠...</div>
                            </div>
                        </div>
                        
                        <!-- 1.3 Ê∑ªÂä†ÊñπÂºèÁªüËÆ° & 1.4 ÊÄßÂà´ÁªüËÆ° -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; margin-bottom: 24px;">
                            <!-- Ê∑ªÂä†ÊñπÂºè -->
                            <div style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 0 2px 0 rgba(145, 158, 171, 0.2), 0 12px 24px -4px rgba(145, 158, 171, 0.12);">
                                <h3 style="margin: 0 0 20px 0; font-size: 15px; font-weight: 700; color: #212B36; letter-spacing: -0.5px;">
                                    Ê∑ªÂä†ÊñπÂºèÂàÜÊûê
                                </h3>
                                <div id="add-way-chart" style="min-height: 250px;"></div>
                            </div>
                            
                            <!-- ÊÄßÂà´ÁªüËÆ° + Êó∂Èó¥Áª¥Â∫¶ÁªüËÆ° -->
                            <div style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 0 2px 0 rgba(145, 158, 171, 0.2), 0 12px 24px -4px rgba(145, 158, 171, 0.12);">
                                <h3 style="margin: 0 0 20px 0; font-size: 15px; font-weight: 700; color: #212B36; letter-spacing: -0.5px;">
                                    ÊÄßÂà´ÂàÜÂ∏É
                                </h3>
                                <div id="gender-chart" style="min-height: 120px; margin-bottom: 24px;"></div>
                                
                                <!-- Êó∂Èó¥Áª¥Â∫¶ÁªüËÆ° -->
                                <div style="border-top: 2px solid rgba(145, 158, 171, 0.12); padding-top: 24px; margin-top: 24px;">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 20px;">
                                        <i class="fas fa-chart-line" style="color: #00A76F; font-size: 18px;"></i>
                                        <h4 style="margin: 0; font-size: 15px; font-weight: 700; color: #212B36; letter-spacing: -0.5px;">
                                            Êñ∞Â¢ûÂÆ¢Êà∑ÁªüËÆ°
                                        </h4>
                                    </div>
                                    <div id="time-stats-chart" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                                        <div style="color: #637381; text-align: center; padding: 20px;">Âä†ËΩΩ‰∏≠...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ê®°Âùó2ÔºöÊúàÂ∫¶Â¢ûÈïøË∂ãÂäø -->
                        <div style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 0 2px 0 rgba(145, 158, 171, 0.2), 0 12px 24px -4px rgba(145, 158, 171, 0.12); margin-top: 40px; margin-bottom: 24px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3 style="margin: 0; font-size: 15px; font-weight: 700; color: #212B36; letter-spacing: -0.5px;">
                                    ÊúàÂ∫¶Â¢ûÈïøË∂ãÂäø
                                </h3>
                                <div style="display: flex; gap: 12px;">
                                    <select id="growth-year-filter" onchange="loadMonthlyGrowth()" style="padding: 8px 12px; border: 1px solid rgba(145, 158, 171, 0.24); border-radius: 8px; font-size: 13px; color: #212B36; background: white; cursor: pointer;">
                                        <!-- Âπ¥‰ªΩÈÄâÈ°πÂ∞ÜÁî±JSÁîüÊàê -->
                                    </select>
                                    <select id="growth-tag-filter" onchange="loadMonthlyGrowth()" style="padding: 8px 12px; border: 1px solid rgba(145, 158, 171, 0.24); border-radius: 8px; font-size: 13px; color: #212B36; background: white; cursor: pointer;">
                                        <option value="all">ÂÖ®ÈÉ®ÂÆ¢Êà∑</option>
                                        <option value="user">Áî®Êà∑Ê†áÁ≠æ</option>
                                        <option value="agent">‰ª£ÁêÜÂïÜ</option>
                                        <option value="partner">Âêà‰ºô‰∫∫</option>
                                        <option value="supplier">‰æõÂ∫îÂïÜ</option>
                                        <option value="peer">ÂêåË°å</option>
                                        <option value="old-agent">ÂéüÊúâËÄÅ‰ª£ÁêÜ</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- ÁªüËÆ°Êï∞ÊçÆÂç°Áâá -->
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
                                <div style="padding: 16px; background: rgba(0, 184, 217, 0.08); border-radius: 12px;">
                                    <div style="font-size: 12px; color: #637381; margin-bottom: 4px;">ÊÄªÂ¢ûÈïø</div>
                                    <div id="growth-total" style="font-size: 24px; font-weight: 700; color: #00B8D9;">-</div>
                                </div>
                                <div style="padding: 16px; background: rgba(255, 171, 0, 0.08); border-radius: 12px;">
                                    <div style="font-size: 12px; color: #637381; margin-bottom: 4px;">Âπ≥ÂùáÊúàÂ¢û</div>
                                    <div id="growth-avg" style="font-size: 24px; font-weight: 700; color: #FFAB00;">-</div>
                                </div>
                                <div style="padding: 16px; background: rgba(54, 179, 126, 0.08); border-radius: 12px;">
                                    <div style="font-size: 12px; color: #637381; margin-bottom: 4px;">ÊúÄÈ´òÊúà‰ªΩ</div>
                                    <div id="growth-max" style="font-size: 14px; font-weight: 600; color: #36B37E;">-</div>
                                </div>
                                <div style="padding: 16px; background: rgba(255, 86, 48, 0.08); border-radius: 12px;">
                                    <div style="font-size: 12px; color: #637381; margin-bottom: 4px;">ÊúÄ‰ΩéÊúà‰ªΩ</div>
                                    <div id="growth-min" style="font-size: 14px; font-weight: 600; color: #FF5630;">-</div>
                                </div>
                            </div>
                            
                            <!-- ÂõæË°® -->
                            <canvas id="monthly-growth-chart" style="max-height: 350px;"></canvas>
                        </div>
                        
                        <!-- Ê®°Âùó3ÔºöÂëòÂ∑•ÊéíË°åÊ¶ú -->
                        <div style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 0 2px 0 rgba(145, 158, 171, 0.2), 0 12px 24px -4px rgba(145, 158, 171, 0.12); margin-top: 40px; margin-bottom: 24px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3 style="margin: 0; font-size: 15px; font-weight: 700; color: #212B36; letter-spacing: -0.5px;">
                                    ÂëòÂ∑•ÊéíË°åÊ¶ú
                                </h3>
                                <select id="ranking-tag-filter" onchange="loadEmployeeRanking()" style="padding: 8px 12px; border: 1px solid rgba(145, 158, 171, 0.24); border-radius: 8px; font-size: 13px; color: #212B36; background: white; cursor: pointer;">
                                    <option value="all">ÂÖ®ÈÉ®ÂÆ¢Êà∑</option>
                                    <option value="user">Áî®Êà∑Ê†áÁ≠æ</option>
                                    <option value="agent">‰ª£ÁêÜÂïÜ</option>
                                    <option value="partner">Âêà‰ºô‰∫∫</option>
                                    <option value="supplier">‰æõÂ∫îÂïÜ</option>
                                    <option value="peer">ÂêåË°å</option>
                                    <option value="old-agent">ÂéüÊúâËÄÅ‰ª£ÁêÜ</option>
                                </select>
                            </div>
                            
                            <div id="employee-ranking-list" style="min-height: 200px;">
                                <div style="color: #637381; padding: 40px; text-align: center; font-size: 14px;">Âä†ËΩΩ‰∏≠...</div>
                            </div>
                        </div>
                        
                        <!-- Ê®°Âùó4ÔºöÊ†áÁ≠æÁªÑÂêàÂàÜÊûê -->
                        <div style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 0 2px 0 rgba(145, 158, 171, 0.2), 0 12px 24px -4px rgba(145, 158, 171, 0.12); margin-top: 40px; margin-bottom: 24px;">
                            <h3 style="margin: 0 0 20px 0; font-size: 15px; font-weight: 700; color: #212B36; letter-spacing: -0.5px;">
                                Ê†áÁ≠æÁªÑÂêàÂàÜÊûê
                            </h3>
                            
                            <!-- Ê†áÁ≠æÈÄâÊã©Âô® -->
                            <div style="margin-bottom: 24px;">
                                <div style="display: flex; gap: 12px; align-items: flex-start;">
                                    <div style="flex: 1;">
                                        <input type="text" id="combo-tag-input" placeholder="ËæìÂÖ•Ê†áÁ≠æÂêçÔºåÁî®ÈÄóÂè∑ÂàÜÈöîÔºå‰æãÂ¶ÇÔºöÂõõÂ∑ù,‰ª£ÁêÜÂïÜ" 
                                               style="width: 100%; padding: 12px 16px; border: 1px solid rgba(145, 158, 171, 0.24); border-radius: 8px; font-size: 14px; color: #212B36;">
                                    </div>
                                    <button onclick="searchTagCombination()" class="btn btn-primary" style="white-space: nowrap;">
                                        <i class="fas fa-search"></i> Êü•ËØ¢
                                    </button>
                                </div>
                                <div id="combo-result" style="margin-top: 16px; padding: 16px; background: rgba(0, 184, 217, 0.08); border-radius: 8px; display: none;">
                                    <div style="font-size: 14px; color: #212B36;">
                                        ÊâæÂà∞ <strong id="combo-count" style="color: #00B8D9; font-size: 18px;">0</strong> ‰ΩçÂÆ¢Êà∑
                                        <button onclick="showCombinationCustomers()" style="margin-left: 12px; padding: 6px 12px; border: 1px solid #00B8D9; border-radius: 6px; background: white; color: #00B8D9; font-size: 13px; cursor: pointer;">
                                            Êü•ÁúãÂàóË°®
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ÂàÜÈöîÁ∫ø -->
                            <div style="height: 1px; background: rgba(145, 158, 171, 0.12); margin: 32px 0;"></div>
                            
                            <!-- ÁÉ≠Èó®ÁªÑÂêà -->
                            <div>
                                <h4 style="font-size: 14px; font-weight: 600; color: #212B36; margin-bottom: 16px; letter-spacing: -0.3px;">
                                    <i class="fas fa-fire" style="color: #FF5630; margin-right: 6px;"></i>
                                    ÁÉ≠Èó®Ê†áÁ≠æÁªÑÂêà TOP 10
                                </h4>
                                <div id="hot-combinations-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 12px;">
                                    <div style="color: #637381; padding: 20px; font-size: 14px;">Âä†ËΩΩ‰∏≠...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- ‰ºÅ‰∏öÊ†áÁ≠æÊ®°Âùó -->
                <section id="module-enterprise-tags" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-tag"></i>
                            ‰ºÅ‰∏öÊ†áÁ≠æÁÆ°ÁêÜ
                        </h1>
                        <div class="page-actions">
                            <button class="btn btn-outlined" onclick="syncEnterpriseTags()">
                                <i class="fas fa-sync-alt"></i>
                                ÂêåÊ≠•Ê†áÁ≠æ
                            </button>
                            <button class="btn btn-primary" onclick="addTagGroup()">
                                <i class="fas fa-plus"></i>
                                Êñ∞Âª∫Ê†áÁ≠æÁªÑ
                            </button>
                        </div>
                    </div>
                    
                    <!-- Ê†áÁ≠æÁªÑÂàóË°® -->
                    <div class="card">
                        <div id="tag-groups-container">
                            <div style="text-align: center; padding: 60px 0; color: var(--grey-500);">
                                <i class="fas fa-tags" style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;"></i>
                                <p>ÊöÇÊó†Ê†áÁ≠æÊï∞ÊçÆ</p>
                                <p style="font-size: 13px;">ÁÇπÂáªÂè≥‰∏äËßí"ÂêåÊ≠•Ê†áÁ≠æ"ÊåâÈíÆ‰ªé‰ºÅ‰∏öÂæÆ‰ø°ÂêåÊ≠•Ê†áÁ≠æ</p>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- ‰ºÅ‰∏öÈÄöËÆØÂΩïÊ®°Âùó -->
                <section id="module-enterprise-contacts" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-address-book"></i>
                            ‰ºÅ‰∏öÈÄöËÆØÂΩï
                        </h1>
                        <div class="page-actions">
                            <button class="btn btn-outlined" onclick="syncEmployees()">
                                <i class="fas fa-sync-alt"></i>
                                ÂêåÊ≠•ÈÄöËÆØÂΩï
                            </button>
                            <button class="btn btn-outlined" onclick="exportEmployees()">
                                <i class="fas fa-download"></i>
                                ÂØºÂá∫
                            </button>
                        </div>
                    </div>
                    
                    <!-- ÊêúÁ¥¢ÂíåÁ≠õÈÄâ -->
                    <div class="card mb-6">
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 16px; padding: 20px;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">ÊêúÁ¥¢ÂëòÂ∑•</label>
                                <input type="text" class="form-control" id="employee-search" 
                                       placeholder="ÊêúÁ¥¢ÂßìÂêç„ÄÅÊâãÊú∫Âè∑„ÄÅÈÇÆÁÆ±..." onkeyup="searchEmployees()">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">ÈÉ®Èó®Á≠õÈÄâ</label>
                                <select class="form-control" id="employee-dept-filter" onchange="filterEmployees()">
                                    <option value="">ÂÖ®ÈÉ®ÈÉ®Èó®</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÂëòÂ∑•ÂàóË°®ÔºàÂç°ÁâáÂºèÔºâ -->
                    <div id="contacts-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 24px;">
                        <!-- Á©∫Áä∂ÊÄÅ -->
                        <div style="grid-column: 1/-1; text-align: center; padding: 80px 20px; color: var(--grey-500);">
                            <i class="fas fa-address-book" style="font-size: 64px; margin-bottom: 16px; display: block; opacity: 0.3;"></i>
                            <p style="font-size: 16px; margin-bottom: 8px;">ÊöÇÊó†ÂëòÂ∑•Êï∞ÊçÆ</p>
                            <p style="font-size: 14px; color: var(--grey-400); margin-bottom: 24px;">
                                ÁÇπÂáªÂè≥‰∏äËßí"ÂêåÊ≠•ÈÄöËÆØÂΩï"ÊåâÈíÆ‰ªé‰ºÅ‰∏öÂæÆ‰ø°ÂêåÊ≠•ÂëòÂ∑•Êï∞ÊçÆ
                            </p>
                            <button class="btn btn-primary" onclick="syncEmployees()">
                                <i class="fas fa-sync-alt"></i>
                                Á´ãÂç≥ÂêåÊ≠•
                            </button>
                        </div>
                    </div>
                    
                    <!-- ÂàÜÈ°µ -->
                    <div class="card" style="margin-top: 24px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px;">
                            <div style="color: var(--grey-600); font-size: 14px;">
                                ÂÖ± <strong id="employee-total-count" style="color: var(--grey-900);">0</strong> ‰∫∫
                            </div>
                            <div style="display: flex; align-items: center; gap: 16px;">
                                <button class="btn btn-outlined btn-sm" onclick="changeEmployeePage(-1)" id="btn-emp-prev">
                                    <i class="fas fa-chevron-left"></i>
                                    ‰∏ä‰∏ÄÈ°µ
                                </button>
                                <span style="color: var(--grey-700); font-size: 14px;">
                                    Á¨¨ <strong id="employee-current-page" style="color: var(--primary-main);">1</strong> È°µ / 
                                    ÂÖ± <strong id="employee-total-pages" style="color: var(--grey-900);">1</strong> È°µ
                                </span>
                                <button class="btn btn-outlined btn-sm" onclick="changeEmployeePage(1)" id="btn-emp-next">
                                    ‰∏ã‰∏ÄÈ°µ
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- ÂÆ¢Êà∑Áæ§ÂàóË°®Ê®°Âùó -->
                <section id="module-customer-groups" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-user-friends"></i>
                            ÂÆ¢Êà∑Áæ§ÂàóË°®
                        </h1>
                        <div class="page-actions">
                            <button class="btn btn-primary" onclick="showBatchTagDialog()" id="batch-tag-btn" style="display:none;">
                                <i class="fas fa-tags"></i> ÊâπÈáèÊâìÊ†áÁ≠æ
                            </button>
                            <button class="btn btn-secondary" onclick="syncCustomerGroups()">
                                <i class="fas fa-sync"></i> ÂêåÊ≠•Áæ§ËÅä
                            </button>
                            <button class="btn btn-outlined" onclick="exportGroups()">
                                <i class="fas fa-download"></i> ÂØºÂá∫
                            </button>
                        </div>
                    </div>

                    <!-- Á≠õÈÄâÂå∫Âüü -->
                    <div class="card mb-6">
                        <div class="filter-container">
                            <div class="filter-row">
                                <div class="filter-item">
                                    <input type="text" 
                                           class="filter-input" 
                                           id="group-filter-search" 
                                           placeholder="ÊêúÁ¥¢Áæ§ËÅäÂêçÁß∞/Áæ§‰∏ª"
                                           onkeyup="filterGroups()">
                                </div>
                                
                                <div class="filter-item">
                                    <select class="filter-select" id="group-filter-owner" onchange="filterGroups()">
                                        <option value="">Áæ§‰∏ª</option>
                                    </select>
                                </div>
                                
                                <div class="filter-item">
                                    <select class="filter-select" id="group-filter-type" onchange="filterGroups()">
                                        <option value="">Áæ§Á±ªÂûã</option>
                                        <option value="internal">ÂÜÖÈÉ®Áæ§</option>
                                        <option value="external">Â§ñÈÉ®Áæ§</option>
                                    </select>
                                </div>
                                
                                <div class="filter-item">
                                    <input type="date" class="filter-input" id="group-filter-date-start" onchange="filterGroups()">
                                </div>
                                
                                <div class="filter-item">
                                    <input type="date" class="filter-input" id="group-filter-date-end" onchange="filterGroups()">
                                </div>
                                
                                <div class="filter-item">
                                    <select class="filter-select" id="group-filter-tag" onchange="filterGroups()">
                                        <option value="">Áæ§Ê†áÁ≠æ</option>
                                    </select>
                                </div>
                                
                                <div class="filter-actions">
                                    <span id="group-filter-result-count"></span>
                                    <button class="btn btn-primary" onclick="applyGroupFilters()">
                                        <i class="fas fa-search"></i> Êü•ËØ¢
                                    </button>
                                    <button class="btn btn-outlined" onclick="resetGroupFilters()">
                                        <i class="fas fa-redo"></i> ÈáçÁΩÆ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ÂÆ¢Êà∑Áæ§ÂàóË°®Ë°®Ê†º -->
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th style="width: 50px;">
                                        <input type="checkbox" id="select-all-groups" onchange="toggleSelectAllGroups()">
                                    </th>
                                    <th style="width: 60px;">Â∫èÂè∑</th>
                                    <th>Áæ§ËÅä</th>
                                    <th>Áæ§‰∏ª</th>
                                    <th style="width: 100px;">ÊÄª‰∫∫Êï∞</th>
                                    <th style="width: 100px;">Â§ñÈÉ®ÂÆ¢Êà∑</th>
                                    <th style="width: 100px;">ÂÜÖÈÉ®ÂëòÂ∑•</th>
                                    <th>Áæ§ÂÖ¨Âëä</th>
                                    <th style="width: 100px;">Áæ§Á±ªÂûã</th>
                                    <th style="width: 100px;">Áæ§Áä∂ÊÄÅ</th>
                                    <th style="width: 200px;">Áæ§Ê†áÁ≠æ</th>
                                    <th style="width: 150px;">ÂàõÂª∫Êó∂Èó¥</th>
                                    <th style="width: 150px;">Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="customer-groups-list">
                                <!-- Áæ§ËÅäÂàóË°®Â∞ÜÈÄöËøá JavaScript Âä®ÊÄÅÊ∏≤Êüì -->
                            </tbody>
                        </table>
                    </div>

                    <!-- ÂàÜÈ°µ -->
                    <div class="card mt-4" style="padding: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="color: var(--grey-600); font-size: 14px;">
                                ÂÖ± <strong id="group-total-count" style="color: var(--primary-main);">0</strong> ‰∏™Áæ§ËÅä
                            </div>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <button class="btn btn-outlined btn-sm" onclick="changeGroupPage(-1)">
                                    <i class="fas fa-chevron-left"></i> ‰∏ä‰∏ÄÈ°µ
                                </button>
                                <span style="color: var(--grey-600); font-size: 14px;">
                                    Á¨¨ <strong id="group-current-page" style="color: var(--primary-main);">1</strong> È°µ / 
                                    ÂÖ± <strong id="group-total-pages" style="color: var(--primary-main);">1</strong> È°µ
                                </span>
                                <button class="btn btn-outlined btn-sm" onclick="changeGroupPage(1)">
                                    ‰∏ã‰∏ÄÈ°µ <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- ÂÆ¢Êà∑Áæ§Ê†áÁ≠æÊ®°Âùó -->
                <section id="module-group-tags" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-tags"></i>
                            ÂÆ¢Êà∑Áæ§Ê†áÁ≠æ
                        </h1>
                        <div class="page-actions">
                            <button class="btn btn-primary" onclick="syncGroupTags()" title="Ê£ÄÊü•ÂΩìÂâçÊ†áÁ≠æÊï∞ÊçÆ">
                                <i class="fas fa-sync-alt"></i>
                                Ê£ÄÊü•Ê†áÁ≠æ
                            </button>
                            <button class="btn btn-primary" onclick="showAddGroupTagDialog()">
                                <i class="fas fa-plus"></i>
                                Êñ∞Âª∫Ê†áÁ≠æÁªÑ
                            </button>
                        </div>
                    </div>
                    
                    <!-- ÊêúÁ¥¢Âå∫Âüü -->
                    <div class="card mb-6">
                        <div style="padding: 16px 20px;">
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <input type="text" id="group-tag-search" placeholder="ÊêúÁ¥¢Ê†áÁ≠æÁªÑÊàñÊ†áÁ≠æ..." 
                                    style="flex: 1; height: 36px; padding: 0 12px; border: 1px solid #DFE3E8; border-radius: 6px; font-size: 14px;"
                                    oninput="searchGroupTags()">
                                <button class="btn btn-outlined" onclick="searchGroupTags()">
                                    <i class="fas fa-search"></i> ÊêúÁ¥¢
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ê†áÁ≠æÁªÑÂàóË°® -->
                    <div id="group-tags-container">
                        <!-- Ê†áÁ≠æÁªÑÂç°ÁâáÂ∞ÜÂä®ÊÄÅÊèíÂÖ•ËøôÈáå -->
                    </div>
                    
                    <!-- Á©∫Áä∂ÊÄÅ -->
                    <div id="group-tags-empty" class="empty-state" style="display: none; padding: 100px 20px; text-align: center;">
                        <div style="font-size: 64px; opacity: 0.3; margin-bottom: 20px;">üìã</div>
                        <h3 style="color: var(--grey-700); margin-bottom: 10px;">ÊöÇÊó†Ê†áÁ≠æÁªÑ</h3>
                        <p style="color: var(--grey-500); margin-bottom: 24px;">
                            Êú¨Á≥ªÁªü‰ΩøÁî®Ëá™Âª∫Ê†áÁ≠æÁ≥ªÁªüÔºåÊ†áÁ≠æÂÆåÂÖ®Áî±ÊÇ®Ëá™‰∏ªÂàõÂª∫ÁÆ°ÁêÜ„ÄÇ<br>
                            ÁÇπÂáª„ÄåÊñ∞Âª∫Ê†áÁ≠æÁªÑ„ÄçÂºÄÂßãÂàõÂª∫ÊÇ®ÁöÑÁ¨¨‰∏Ä‰∏™Ê†áÁ≠æÁªÑ„ÄÇ
                        </p>
                        <button class="btn btn-primary" onclick="showAddGroupTagDialog()">
                            <i class="fas fa-plus"></i> Êñ∞Âª∫Ê†áÁ≠æÁªÑ
                        </button>
                    </div>
                </section>
                
                <!-- Ê¨¢ËøéËØ≠ËÆæÁΩÆÊ®°Âùó -->
                <section id="module-welcome-msg" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-hand-paper"></i>
                            Ê¨¢ËøéËØ≠ËÆæÁΩÆ
                        </h1>
                    </div>
                    <div class="empty-state" style="padding: 100px 20px; text-align: center;">
                        <div style="font-size: 64px; opacity: 0.3; margin-bottom: 20px;">üöß</div>
                        <h3 style="color: var(--grey-700); margin-bottom: 10px;">ÂäüËÉΩÂºÄÂèë‰∏≠</h3>
                        <p style="color: var(--grey-500);">Ê¨¢ËøéËØ≠ËÆæÁΩÆÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠...</p>
                    </div>
                </section>
                
                <!-- ÂÆ¢Êà∑Áæ§ÂèëÊ®°Âùó -->
                <section id="module-customer-broadcast" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-paper-plane"></i>
                            ÂÆ¢Êà∑Áæ§Âèë
                        </h1>
                    </div>
                    <div class="empty-state" style="padding: 100px 20px; text-align: center;">
                        <div style="font-size: 64px; opacity: 0.3; margin-bottom: 20px;">üöß</div>
                        <h3 style="color: var(--grey-700); margin-bottom: 10px;">ÂäüËÉΩÂºÄÂèë‰∏≠</h3>
                        <p style="color: var(--grey-500);">ÂÆ¢Êà∑Áæ§ÂèëÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠...</p>
                    </div>
                </section>
                
                <!-- ÂèëÊúãÂèãÂúàÊ®°Âùó -->
                <section id="module-moments-publish" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-share-alt"></i>
                            ÂèëÊúãÂèãÂúà
                        </h1>
                    </div>
                    <div class="empty-state" style="padding: 100px 20px; text-align: center;">
                        <div style="font-size: 64px; opacity: 0.3; margin-bottom: 20px;">üöß</div>
                        <h3 style="color: var(--grey-700); margin-bottom: 10px;">ÂäüËÉΩÂºÄÂèë‰∏≠</h3>
                        <p style="color: var(--grey-500);">ÂèëÊúãÂèãÂúàÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠...</p>
                    </div>
                </section>
                
                <!-- ÊúãÂèãÂúàËÆ∞ÂΩïÊ®°Âùó -->
                <section id="module-moments-record" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-history"></i>
                            ÊúãÂèãÂúàËÆ∞ÂΩï
                        </h1>
                    </div>
                    <div class="empty-state" style="padding: 100px 20px; text-align: center;">
                        <div style="font-size: 64px; opacity: 0.3; margin-bottom: 20px;">üöß</div>
                        <h3 style="color: var(--grey-700); margin-bottom: 10px;">ÂäüËÉΩÂºÄÂèë‰∏≠</h3>
                        <p style="color: var(--grey-500);">ÊúãÂèãÂúàËÆ∞ÂΩïÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠...</p>
                    </div>
                </section>
                
                <!-- ËøõÁæ§Ê¨¢ËøéËØ≠Ê®°Âùó -->
                <section id="module-group-welcome" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-door-open"></i>
                            ËøõÁæ§Ê¨¢ËøéËØ≠
                        </h1>
                    </div>
                    <div class="empty-state" style="padding: 100px 20px; text-align: center;">
                        <div style="font-size: 64px; opacity: 0.3; margin-bottom: 20px;">üöß</div>
                        <h3 style="color: var(--grey-700); margin-bottom: 10px;">ÂäüËÉΩÂºÄÂèë‰∏≠</h3>
                        <p style="color: var(--grey-500);">ËøõÁæ§Ê¨¢ËøéËØ≠ÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠...</p>
                    </div>
                </section>
                
                <!-- ÂÆ¢Êà∑Áæ§Áæ§ÂèëÊ®°Âùó -->
                <section id="module-group-broadcast" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-broadcast-tower"></i>
                            ÂÆ¢Êà∑Áæ§Áæ§Âèë
                        </h1>
                    </div>
                    <div class="empty-state" style="padding: 100px 20px; text-align: center;">
                        <div style="font-size: 64px; opacity: 0.3; margin-bottom: 20px;">üöß</div>
                        <h3 style="color: var(--grey-700); margin-bottom: 10px;">ÂäüËÉΩÂºÄÂèë‰∏≠</h3>
                        <p style="color: var(--grey-500);">ÂÆ¢Êà∑Áæ§Áæ§ÂèëÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠...</p>
                    </div>
                </section>
                
                <!-- ÂÆ¢Êà∑ËøêËê•Ê®°ÂùóÔºàÂà†Èô§Ôºâ -->
                <!-- ÂÆ¢Êà∑Áæ§ËøêËê•Ê®°ÂùóÔºàÂà†Èô§Ôºâ -->
                
                <!-- ‰æõÂ∫îÂïÜÈÄöÁü•Áæ§Ê®°Âùó -->
                <section id="module-supplier-notify" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-bell"></i>
                            ‰æõÂ∫îÂïÜÈÄöÁü•Áæ§
                        </h1>
                        <div class="page-actions">
                            <button class="btn btn-outlined" onclick="showAddWebhookDialog('supplier')">
                                <i class="fas fa-plus-circle"></i>
                                Ê∑ªÂä†Áæ§
                            </button>
                            <button class="btn btn-primary" onclick="showCreateNotificationDialog('supplier')">
                                <i class="fas fa-paper-plane"></i>
                                ÂàõÂª∫ÈÄöÁü•
                            </button>
                        </div>
                    </div>
                    
                    <!-- Â∑≤ÈÖçÁΩÆÁöÑÁæ§ -->
                    <div class="card" style="margin-bottom: 20px;">
                        <div class="card-header">
                            <h3>Â∑≤ÈÖçÁΩÆÁöÑÁæ§</h3>
                            <p class="text-muted">
                                <i class="fas fa-info-circle"></i> 
                                ÊèêÈÜíÔºöÁæ§Êú∫Âô®‰∫∫‰ªÖÊîØÊåÅ<strong>ÂÜÖÈÉ®Áæ§</strong>ÔºàÁ∫ØÂëòÂ∑•Áæ§ÔºâÔºå‰∏çÊîØÊåÅÂ§ñÈÉ®Áæ§
                            </p>
                        </div>
                        <div class="card-body">
                            <div id="supplier-webhook-list">
                                <div class="text-center" style="padding: 40px; color: #999;">
                                    <i class="fas fa-robot" style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;"></i>
                                    <p>ÊöÇÊó†ÈÖçÁΩÆÔºåÁÇπÂáª"Ê∑ªÂä†Áæ§"ÂºÄÂßãÈÖçÁΩÆ</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÈÄöÁü•ËÆ∞ÂΩï -->
                    <div class="card">
                        <div class="card-header">
                            <h3>ÈÄöÁü•ËÆ∞ÂΩï</h3>
                            <p class="text-muted">ÊúÄËøëÁöÑÊ∂àÊÅØÊé®ÈÄÅËÆ∞ÂΩï</p>
                        </div>
                        <div class="card-body">
                            <div id="supplier-notification-list">
                                <div class="text-center" style="padding: 40px; color: #999;">
                                    <i class="fas fa-history" style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;"></i>
                                    <p>ÊöÇÊó†ÈÄöÁü•ËÆ∞ÂΩï</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- ‰ª£ÁêÜÂïÜÈÄöÁü•Áæ§Ê®°Âùó -->
                <section id="module-agent-notify" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-bullhorn"></i>
                            ‰ª£ÁêÜÂïÜÈÄöÁü•Áæ§
                        </h1>
                        <div class="page-actions">
                            <button class="btn btn-outlined" onclick="showAddWebhookDialog('agent')">
                                <i class="fas fa-plus-circle"></i>
                                Ê∑ªÂä†Áæ§
                            </button>
                            <button class="btn btn-primary" onclick="showCreateNotificationDialog('agent')">
                                <i class="fas fa-paper-plane"></i>
                                ÂàõÂª∫ÈÄöÁü•
                            </button>
                        </div>
                    </div>
                    
                    <!-- Â∑≤ÈÖçÁΩÆÁöÑÁæ§ -->
                    <div class="card" style="margin-bottom: 20px;">
                        <div class="card-header">
                            <h3>Â∑≤ÈÖçÁΩÆÁöÑÁæ§</h3>
                            <p class="text-muted">
                                <i class="fas fa-info-circle"></i> 
                                ÊèêÈÜíÔºöÁæ§Êú∫Âô®‰∫∫‰ªÖÊîØÊåÅ<strong>ÂÜÖÈÉ®Áæ§</strong>ÔºàÁ∫ØÂëòÂ∑•Áæ§ÔºâÔºå‰∏çÊîØÊåÅÂ§ñÈÉ®Áæ§
                            </p>
                        </div>
                        <div class="card-body">
                            <div id="agent-webhook-list">
                                <div class="text-center" style="padding: 40px; color: #999;">
                                    <i class="fas fa-robot" style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;"></i>
                                    <p>ÊöÇÊó†ÈÖçÁΩÆÔºåÁÇπÂáª"Ê∑ªÂä†Áæ§"ÂºÄÂßãÈÖçÁΩÆ</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÈÄöÁü•ËÆ∞ÂΩï -->
                    <div class="card">
                        <div class="card-header">
                            <h3>ÈÄöÁü•ËÆ∞ÂΩï</h3>
                            <p class="text-muted">ÊúÄËøëÁöÑÊ∂àÊÅØÊé®ÈÄÅËÆ∞ÂΩï</p>
                        </div>
                        <div class="card-body">
                            <div id="agent-notification-list">
                                <div class="text-center" style="padding: 40px; color: #999;">
                                    <i class="fas fa-history" style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;"></i>
                                    <p>ÊöÇÊó†ÈÄöÁü•ËÆ∞ÂΩï</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- ËÆ¢ÂçïÊï∞ÊçÆÊ®°Âùó -->
                <section id="module-order-data" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-shopping-cart"></i>
                            ËÆ¢ÂçïÊï∞ÊçÆ
                        </h1>
                        <div class="page-actions">
                            <button class="btn btn-outlined">
                                <i class="fas fa-filter"></i>
                                Á≠õÈÄâ
                            </button>
                            <button class="btn btn-outlined">
                                <i class="fas fa-download"></i>
                                ÂØºÂá∫
                            </button>
                            <button class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                                Êñ∞Âª∫ËÆ¢Âçï
                            </button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="empty-state" style="padding: 80px 20px; text-align: center;">
                                <i class="fas fa-shopping-cart" style="font-size: 64px; opacity: 0.3; margin-bottom: 20px; display: block; color: #00B8D9;"></i>
                                <h3 style="color: var(--grey-700); margin-bottom: 10px;">ËÆ¢ÂçïÊï∞ÊçÆÁÆ°ÁêÜ</h3>
                                <p style="color: var(--grey-500); margin-bottom: 20px;">Êü•ÁúãÂíåÁÆ°ÁêÜÊâÄÊúâËÆ¢Âçï‰ø°ÊÅØ</p>
                                <button class="btn btn-primary">ÂºÄÂßãÂØºÂÖ•ËÆ¢ÂçïÊï∞ÊçÆ</button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- ‰æõÂ∫îÂïÜÊï∞ÊçÆÊ®°Âùó -->
                <section id="module-supplier-data" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-truck"></i>
                            ‰æõÂ∫îÂïÜÊï∞ÊçÆ
                        </h1>
                        <div class="page-actions">
                            <button class="btn btn-outlined">
                                <i class="fas fa-filter"></i>
                                Á≠õÈÄâ
                            </button>
                            <button class="btn btn-outlined">
                                <i class="fas fa-download"></i>
                                ÂØºÂá∫
                            </button>
                            <button class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                                Êñ∞Â¢û‰æõÂ∫îÂïÜ
                            </button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="empty-state" style="padding: 80px 20px; text-align: center;">
                                <i class="fas fa-truck" style="font-size: 64px; opacity: 0.3; margin-bottom: 20px; display: block; color: #00A76F;"></i>
                                <h3 style="color: var(--grey-700); margin-bottom: 10px;">‰æõÂ∫îÂïÜÊï∞ÊçÆÁÆ°ÁêÜ</h3>
                                <p style="color: var(--grey-500); margin-bottom: 20px;">ÁÆ°ÁêÜ‰æõÂ∫îÂïÜ‰ø°ÊÅØ„ÄÅÂêà‰ΩúËÆ∞ÂΩï„ÄÅËØÑ‰ª∑Á≠â</p>
                                <button class="btn btn-primary">ÂºÄÂßãÂØºÂÖ•‰æõÂ∫îÂïÜÊï∞ÊçÆ</button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- ‰∫ßÂìÅÊï∞ÊçÆÊ®°Âùó -->
                <section id="module-product-data" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-box"></i>
                            ‰∫ßÂìÅÊï∞ÊçÆ
                        </h1>
                        <div class="page-actions">
                            <button class="btn btn-outlined">
                                <i class="fas fa-filter"></i>
                                Á≠õÈÄâ
                            </button>
                            <button class="btn btn-outlined">
                                <i class="fas fa-download"></i>
                                ÂØºÂá∫
                            </button>
                            <button class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                                Êñ∞Â¢û‰∫ßÂìÅ
                            </button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="empty-state" style="padding: 80px 20px; text-align: center;">
                                <i class="fas fa-box" style="font-size: 64px; opacity: 0.3; margin-bottom: 20px; display: block; color: #FF6B2C;"></i>
                                <h3 style="color: var(--grey-700); margin-bottom: 10px;">‰∫ßÂìÅÊï∞ÊçÆÁÆ°ÁêÜ</h3>
                                <p style="color: var(--grey-500); margin-bottom: 20px;">‰∫ßÂìÅÂ∫ìÂ≠ò„ÄÅSKU„ÄÅ‰ª∑Ê†º„ÄÅËßÑÊ†ºÁ≠â‰ø°ÊÅØÁÆ°ÁêÜ</p>
                                <button class="btn btn-primary">ÂºÄÂßãÂØºÂÖ•‰∫ßÂìÅÊï∞ÊçÆ</button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- ‰ª£ÁêÜÂïÜÊï∞ÊçÆÊ®°Âùó -->
                <section id="module-agent-data" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-users"></i>
                            ‰ª£ÁêÜÂïÜÊï∞ÊçÆ
                        </h1>
                        <div class="page-actions">
                            <button class="btn btn-outlined">
                                <i class="fas fa-filter"></i>
                                Á≠õÈÄâ
                            </button>
                            <button class="btn btn-outlined">
                                <i class="fas fa-download"></i>
                                ÂØºÂá∫
                            </button>
                            <button class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                                Êñ∞Â¢û‰ª£ÁêÜÂïÜ
                            </button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="empty-state" style="padding: 80px 20px; text-align: center;">
                                <i class="fas fa-users" style="font-size: 64px; opacity: 0.3; margin-bottom: 20px; display: block; color: #7635DC;"></i>
                                <h3 style="color: var(--grey-700); margin-bottom: 10px;">‰ª£ÁêÜÂïÜÊï∞ÊçÆÁÆ°ÁêÜ</h3>
                                <p style="color: var(--grey-500); margin-bottom: 20px;">‰ª£ÁêÜÂïÜ‰ø°ÊÅØ„ÄÅÁ∫ßÂà´„ÄÅÈîÄÂîÆ‰∏öÁª©„ÄÅËøîÁÇπÁ≠â</p>
                                <button class="btn btn-primary">ÂºÄÂßãÂØºÂÖ•‰ª£ÁêÜÂïÜÊï∞ÊçÆ</button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Ë¥¢Âä°Êï∞ÊçÆÊ®°Âùó -->
                <section id="module-finance-data" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-dollar-sign"></i>
                            Ë¥¢Âä°Êï∞ÊçÆ
                        </h1>
                        <div class="page-actions">
                            <button class="btn btn-outlined">
                                <i class="fas fa-calendar-alt"></i>
                                Êó∂Èó¥ËåÉÂõ¥
                            </button>
                            <button class="btn btn-outlined">
                                <i class="fas fa-download"></i>
                                ÂØºÂá∫
                            </button>
                            <button class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                                ËÆ∞ÂΩïÊî∂ÊîØ
                            </button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="empty-state" style="padding: 80px 20px; text-align: center;">
                                <i class="fas fa-dollar-sign" style="font-size: 64px; opacity: 0.3; margin-bottom: 20px; display: block; color: #FFAB00;"></i>
                                <h3 style="color: var(--grey-700); margin-bottom: 10px;">Ë¥¢Âä°Êï∞ÊçÆÁÆ°ÁêÜ</h3>
                                <p style="color: var(--grey-500); margin-bottom: 20px;">Êî∂ÂÖ•„ÄÅÊîØÂá∫„ÄÅÂ∫îÊî∂Â∫î‰ªò„ÄÅÂà©Ê∂¶ÂàÜÊûêÁ≠â</p>
                                <button class="btn btn-primary">ÂºÄÂßãÂØºÂÖ•Ë¥¢Âä°Êï∞ÊçÆ</button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- ÂïÜÂä°Êï∞ÊçÆÊ®°Âùó -->
                <section id="module-business-data" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-briefcase"></i>
                            ÂïÜÂä°Êï∞ÊçÆ
                        </h1>
                        <div class="page-actions">
                            <button class="btn btn-outlined">
                                <i class="fas fa-filter"></i>
                                Á≠õÈÄâ
                            </button>
                            <button class="btn btn-outlined">
                                <i class="fas fa-download"></i>
                                ÂØºÂá∫
                            </button>
                            <button class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                                Êñ∞Âª∫ÂïÜÊú∫
                            </button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="empty-state" style="padding: 80px 20px; text-align: center;">
                                <i class="fas fa-briefcase" style="font-size: 64px; opacity: 0.3; margin-bottom: 20px; display: block; color: #FF5630;"></i>
                                <h3 style="color: var(--grey-700); margin-bottom: 10px;">ÂïÜÂä°Êï∞ÊçÆÁÆ°ÁêÜ</h3>
                                <p style="color: var(--grey-500); margin-bottom: 20px;">ÂïÜÊú∫ÁÆ°ÁêÜ„ÄÅÂêàÂêåÁÆ°ÁêÜ„ÄÅÈîÄÂîÆË∑üËøõÁ≠â</p>
                                <button class="btn btn-primary">ÂºÄÂßãÂØºÂÖ•ÂïÜÂä°Êï∞ÊçÆ</button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Êé®ÂÆ¢ÁÆ°ÁêÜÊ®°Âùó -->
                <section id="module-promoter" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-user-plus"></i>
                            Êé®ÂÆ¢ÁÆ°ÁêÜ
                        </h1>
                    </div>
                    <div class="empty-state" style="padding: 100px 20px; text-align: center;">
                        <div style="font-size: 64px; opacity: 0.3; margin-bottom: 20px;">üöß</div>
                        <h3 style="color: var(--grey-700); margin-bottom: 10px;">ÂäüËÉΩÂºÄÂèë‰∏≠</h3>
                        <p style="color: var(--grey-500);">Êé®ÂÆ¢ÁÆ°ÁêÜÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠...</p>
                    </div>
                </section>
                
                <!-- Êô∫ËÉΩË°®Ê†ºÊ®°Âùó -->
                <section id="module-spreadsheet" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-table"></i>
                            Êô∫ËÉΩË°®Ê†º
                        </h1>
                        <div class="page-actions">
                            <button class="btn btn-outlined" id="btn-upload-excel">
                                <i class="fas fa-file-upload"></i>
                                ‰∏ä‰º† Excel
                            </button>
                            <button class="btn btn-primary" id="btn-create-table">
                                <i class="fas fa-plus"></i>
                                ÊâãÂ∑•ÂàõÂª∫
                            </button>
                        </div>
                    </div>
                    
                    <!-- Ë°®Ê†ºÂàóË°® -->
                    <div id="spreadsheet-list" style="display: grid; gap: 24px;">
                        <!-- Âä®ÊÄÅÂä†ËΩΩ -->
                        <div style="text-align: center; padding: 80px 0; color: var(--grey-500);">
                            <i class="fas fa-table" style="font-size: 64px; margin-bottom: 16px; display: block; opacity: 0.3;"></i>
                            <p style="font-size: 18px; margin-bottom: 8px;">ËøòÊ≤°ÊúâÊô∫ËÉΩË°®Ê†º</p>
                            <p style="font-size: 14px; margin-bottom: 24px;">ÁÇπÂáª‰∏äÊñπÊåâÈíÆÂàõÂª∫Á¨¨‰∏Ä‰∏™Ë°®Ê†º</p>
                        </div>
                    </div>
                </section>
                
                <!-- Êï∞ÊçÆÂàÜÊûêÊ®°Âùó -->
                <!-- Á≥ªÁªüËÆæÁΩÆÊ®°Âùó -->
                <section id="module-settings" class="module" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-cog"></i>
                            Á≥ªÁªüËÆæÁΩÆ
                        </h1>
                    </div>
                    
                    <!-- ‰ºÅ‰∏öÂæÆ‰ø°ÈÖçÁΩÆ -->
                    <div class="card mb-6">
                        <div class="card-header">
                            <h3 class="card-title">‰ºÅ‰∏öÂæÆ‰ø°ÈÖçÁΩÆ</h3>
                        </div>
                        <div class="card-body">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                <div class="form-group">
                                    <label class="form-label required">‰ºÅ‰∏ö IDÔºàCorpIDÔºâ</label>
                                    <input type="text" class="form-control" id="settings-corpid" placeholder="ËØ∑ËæìÂÖ•‰ºÅ‰∏ö ID">
                                </div>
                                <div class="form-group">
                                    <label class="form-label required">Ëá™Âª∫Â∫îÁî® Secret</label>
                                    <input type="password" class="form-control" id="settings-app-secret" placeholder="ËØ∑ËæìÂÖ•Ëá™Âª∫Â∫îÁî® Secret">
                                </div>
                                <div class="form-group">
                                    <label class="form-label required">Â∫îÁî® AgentId</label>
                                    <input type="text" class="form-control" id="settings-agentid" placeholder="ËØ∑ËæìÂÖ• AgentId">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">ÈÄöËÆØÂΩï Secret</label>
                                    <input type="password" class="form-control" id="settings-contact-secret" placeholder="ËØ∑ËæìÂÖ•ÈÄöËÆØÂΩï SecretÔºàÂèØÈÄâÔºâ">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">ÂÆ¢Êà∑ËÅîÁ≥ª Secret</label>
                                    <input type="password" class="form-control" id="settings-customer-secret" placeholder="ËØ∑ËæìÂÖ•ÂÆ¢Êà∑ËÅîÁ≥ª SecretÔºàÂèØÈÄâÔºâ">
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-outlined" onclick="resetWecomConfig()">
                                <i class="fas fa-undo"></i>
                                ÈáçÁΩÆ
                            </button>
                            <button class="btn btn-primary" onclick="saveWecomConfig()">
                                <i class="fas fa-save"></i>
                                ‰øùÂ≠òÈÖçÁΩÆ
                            </button>
                        </div>
                    </div>

                    <!-- ÈÖçÁΩÆÂéÜÂè≤ËÆ∞ÂΩï -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-history"></i>
                                ÈÖçÁΩÆÂéÜÂè≤ËÆ∞ÂΩï
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th width="60">Â∫èÂè∑</th>
                                            <th width="150">ÈÖçÁΩÆÁ±ªÂûã</th>
                                            <th>ÈÖçÁΩÆÂÜÖÂÆπ</th>
                                            <th width="150">‰øùÂ≠òÊó∂Èó¥</th>
                                            <th width="100">Êìç‰Ωú‰∫∫</th>
                                            <th width="120">Êìç‰Ωú</th>
                                        </tr>
                                    </thead>
                                    <tbody id="config-history-list">
                                        <tr>
                                            <td colspan="6" style="text-align: center; padding: 60px 20px; color: var(--grey-500);">
                                                <i class="fas fa-history" style="font-size: 48px; margin-bottom: 16px; display: block; opacity: 0.3;"></i>
                                                <p style="font-size: 16px;">ÊöÇÊó†ÈÖçÁΩÆÂéÜÂè≤ËÆ∞ÂΩï</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>
    
    <!-- Toast ÊèêÁ§∫ -->
    <div id="toast" class="toast" style="display: none;">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message">Êìç‰ΩúÊàêÂäü</span>
    </div>
    
    <!-- ÂÆ¢Êà∑ÂàóË°®ÂºπÁ™ó -->
    <div id="customer-list-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 1200px; width: 90%; max-height: 85vh; overflow: hidden; display: flex; flex-direction: column;">
            <div class="modal-header" style="padding: 24px; border-bottom: 1px solid rgba(145, 158, 171, 0.12); flex-shrink: 0;">
                <h3 class="modal-title" style="margin: 0; font-size: 18px; font-weight: 700; color: #212B36;" id="customer-modal-title">ÂÆ¢Êà∑ÂàóË°®</h3>
                <button class="modal-close" onclick="closeCustomerModal()" style="background: none; border: none; font-size: 24px; color: #637381; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 8px; transition: all 0.2s;" onmouseover="this.style.background='rgba(145, 158, 171, 0.08)'" onmouseout="this.style.background='none'">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" style="padding: 24px; overflow-y: auto; overflow-x: auto; flex: 1;">
                <div id="customer-list-content">
                    <div style="text-align: center; padding: 40px; color: #637381;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 32px; margin-bottom: 16px;"></i>
                        <div>Âä†ËΩΩ‰∏≠...</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="padding: 16px 24px; border-top: 1px solid rgba(145, 158, 171, 0.12); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                <div id="customer-modal-pagination" style="font-size: 14px; color: #637381;"></div>
                <button class="btn btn-secondary" onclick="closeCustomerModal()">ÂÖ≥Èó≠</button>
            </div>
        </div>
    </div>
    
    <!-- ÈÖçÁΩÆÂºπÁ™ó -->
    <div id="config-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-cog"></i>
                    ‰ºÅ‰∏öÂæÆ‰ø°ÈÖçÁΩÆ
                </div>
                <button class="modal-close" onclick="closeConfig()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">‰ºÅ‰∏ö IDÔºàCorpIDÔºâ*</label>
                    <input type="text" class="form-control" id="config-corpid" placeholder="ËØ∑ËæìÂÖ•‰ºÅ‰∏ö ID">
                    <small style="color: var(--grey-500); font-size: 12px; margin-top: 4px; display: block;">
                        ÁôªÂΩï‰ºÅ‰∏öÂæÆ‰ø°ÁÆ°ÁêÜÂêéÂè∞ ‚Üí ÊàëÁöÑ‰ºÅ‰∏ö ‚Üí ‰ºÅ‰∏ö‰ø°ÊÅØ ‚Üí ‰ºÅ‰∏ö ID
                    </small>
                </div>
                <div class="form-group">
                    <label class="form-label">ÈÄöËÆØÂΩï SecretÔºàÂèØÈÄâÔºâ</label>
                    <input type="text" class="form-control" id="config-contact-secret" placeholder="ËØ∑ËæìÂÖ•ÈÄöËÆØÂΩïÂ∫îÁî® Secret">
                </div>
                <div class="form-group">
                    <label class="form-label">Ëá™Âª∫Â∫îÁî® SecretÔºàÊé®ËçêÔºâ‚≠ê</label>
                    <input type="text" class="form-control" id="config-app-secret" placeholder="ËØ∑ËæìÂÖ•Ëá™Âª∫Â∫îÁî® Secret">
                    <small style="color: var(--grey-500); font-size: 12px; margin-top: 4px; display: block;">
                        Â∫îÁî®ÁÆ°ÁêÜ ‚Üí Ëá™Âª∫Â∫îÁî® ‚Üí ÁÇπÂáªÂ∫îÁî® ‚Üí Êü•Áúã SecretÔºàÊé®Ëçê‰ΩøÁî®Ê≠§ÊñπÂºèÔºâ
                    </small>
                </div>
                <div class="form-group">
                    <label class="form-label">ÂÆ¢Êà∑ËÅîÁ≥ª SecretÔºàÂèØÈÄâÔºâ</label>
                    <input type="text" class="form-control" id="config-customer-secret" placeholder="ËØ∑ËæìÂÖ•ÂÆ¢Êà∑ËÅîÁ≥ªÂ∫îÁî® Secret">
                </div>
                <div class="form-group">
                    <label class="form-label">Â∫îÁî® AgentId *</label>
                    <input type="text" class="form-control" id="config-agentid" placeholder="ËØ∑ËæìÂÖ•Ëá™Âª∫Â∫îÁî® AgentId">
                    <small style="color: var(--grey-500); font-size: 12px; margin-top: 4px; display: block;">
                        ‰ºÅ‰∏öÂæÆ‰ø°ÁÆ°ÁêÜÂêéÂè∞ ‚Üí Â∫îÁî®ÁÆ°ÁêÜ ‚Üí Ëá™Âª∫Â∫îÁî® ‚Üí AgentId
                    </small>
                </div>
                <div class="form-group">
                    <label class="form-label">API Token</label>
                    <input type="text" class="form-control" id="config-api-token" placeholder="crm-default-token">
                    <small style="color: var(--grey-500); font-size: 12px; margin-top: 4px; display: block;">
                        Áî®‰∫éÂêéÁ´Ø API ËÆ§ËØÅÔºåÈªòËÆ§ÂÄºÔºöcrm-default-token
                    </small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outlined" onclick="closeConfig()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="saveConfig()">
                    <i class="fas fa-save"></i>
                    ‰øùÂ≠òÈÖçÁΩÆ
                </button>
            </div>
        </div>
    </div>
    
    <!-- ÊâãÂ∑•ÂàõÂª∫Ë°®Ê†ºÂØπËØùÊ°Ü -->
    <div id="create-table-modal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-plus-circle"></i>
                    ÊâãÂ∑•ÂàõÂª∫Êô∫ËÉΩË°®Ê†º
                </div>
                <button class="modal-close" onclick="closeCreateTableDialog()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Âü∫Êú¨‰ø°ÊÅØ -->
                <div class="form-group">
                    <label class="form-label">Ë°®Ê†ºÂêçÁß∞ <span style="color: var(--danger);">*</span></label>
                    <input type="text" class="form-control" id="table-name" placeholder="ËØ∑ËæìÂÖ•Ë°®Ê†ºÂêçÁß∞">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label class="form-label">Êï∞ÊçÆÁ±ªÂûã <span style="color: var(--danger);">*</span></label>
                        <select class="form-control" id="table-data-type" onchange="onDataTypeChange()">
                            <option value="order">ËÆ¢Âçï‰ø°ÊÅØ</option>
                            <option value="supplier">‰ª£ÁêÜÂïÜ‰ø°ÊÅØ</option>
                            <option value="product">‰∫ßÂìÅ‰ø°ÊÅØ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Êï∞ÊçÆËåÉÂõ¥ <span style="color: var(--danger);">*</span></label>
                        <select class="form-control" id="table-data-scope" onchange="onDataScopeChange()">
                            <option value="global">ÂÖ®Â±ÄÊï∞ÊçÆ</option>
                            <option value="supplier">ÊåáÂÆö‰æõÂ∫îÂïÜ</option>
                        </select>
                    </div>
                </div>

                <div class="form-group" id="supplier-select-group" style="display: none;">
                    <label class="form-label">ÈÄâÊã©‰æõÂ∫îÂïÜ <span style="color: var(--danger);">*</span></label>
                    <select class="form-control" id="table-supplier-code">
                        <!-- Âä®ÊÄÅÂä†ËΩΩ -->
                    </select>
                </div>

                <div class="card" style="margin: 24px 0;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h4 style="margin: 0; font-size: 16px; font-weight: 600; color: var(--grey-900);">
                            Â≠óÊÆµÈÖçÁΩÆ 
                            <span id="field-count-badge" style="color: var(--primary); font-size: 14px; font-weight: 400;">(0/150)</span>
                        </h4>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-outlined btn-sm" onclick="showTemplateSelector()">
                                <i class="fas fa-file-import"></i> ‰ªéÊ®°ÊùøÂØºÂÖ•
                            </button>
                            <button class="btn btn-primary btn-sm" onclick="showAddFieldDialog()">
                                <i class="fas fa-plus"></i> Ê∑ªÂä†Â≠óÊÆµ
                            </button>
                        </div>
                    </div>

                    <div id="fields-list" style="max-height: 400px; overflow-y: auto;">
                        <!-- Â≠óÊÆµÂàóË°® -->
                        <div style="text-align: center; padding: 60px 20px; color: var(--grey-500);">
                            <i class="fas fa-list" style="font-size: 48px; margin-bottom: 12px; display: block; opacity: 0.3;"></i>
                            <p style="font-size: 14px;">ËøòÊ≤°ÊúâÂ≠óÊÆµÔºåËØ∑Ê∑ªÂä†Êàñ‰ªéÊ®°ÊùøÂØºÂÖ•</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outlined" onclick="closeCreateTableDialog()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="createTableManual()">
                    <i class="fas fa-check"></i> ÂàõÂª∫Ë°®Ê†º
                </button>
            </div>
        </div>
    </div>

    <!-- ÈÄâÊã©Ê®°ÊùøÂØπËØùÊ°Ü -->
    <div id="template-selector-modal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-file-import"></i>
                    ÈÄâÊã©Â≠óÊÆµÊ®°Êùø
                </div>
                <button class="modal-close" onclick="closeTemplateSelector()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="template-list">
                    <!-- Âä®ÊÄÅÂä†ËΩΩÊ®°ÊùøÂàóË°® -->
                </div>
            </div>
        </div>
    </div>

    <!-- Ê∑ªÂä†Â≠óÊÆµÂØπËØùÊ°Ü -->
    <div id="add-field-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-plus"></i>
                    Ê∑ªÂä†Â≠óÊÆµ
                </div>
                <button class="modal-close" onclick="closeAddFieldDialog()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Â≠óÊÆµÊòæÁ§∫ÂêçÁß∞Ôºà‰ºÅ‰∏öÂæÆ‰ø°Ôºâ<span style="color: var(--danger);">*</span></label>
                    <input type="text" class="form-control" id="field-wecom-name" placeholder="‰æãÂ¶ÇÔºöÂÆ¢Êà∑ÂßìÂêç">
                </div>

                <div class="form-group">
                    <label class="form-label">Á≥ªÁªüÂ≠óÊÆµÂêçÔºàËá™ÊúâÁ≥ªÁªüÔºâ<span style="color: var(--danger);">*</span></label>
                    <input type="text" class="form-control" id="field-system-name" placeholder="‰æãÂ¶ÇÔºöcustomer_name">
                    <small style="color: var(--grey-500); font-size: 12px; display: block; margin-top: 4px;">
                        Áî®‰∫éÊò†Â∞ÑËá™ÊúâÁ≥ªÁªüÁöÑÂ≠óÊÆµÔºåÂª∫ËÆÆ‰ΩøÁî®Ëã±Êñá‰∏ãÂàíÁ∫øÂëΩÂêç
                    </small>
                </div>

                <div class="form-group">
                    <label class="form-label">Â≠óÊÆµÁ±ªÂûã</label>
                    <select class="form-control" id="field-type">
                        <option value="text">ÊñáÊú¨</option>
                        <option value="number">Êï∞Â≠ó</option>
                        <option value="datetime">Êó•ÊúüÊó∂Èó¥</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outlined" onclick="closeAddFieldDialog()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="addFieldToList()">
                    <i class="fas fa-check"></i> Ê∑ªÂä†
                </button>
            </div>
        </div>
    </div>

    <!-- ‰∏ä‰º† Excel ÂØπËØùÊ°Ü -->
    <div id="upload-excel-modal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-file-upload"></i>
                    ‰∏ä‰º† Excel ÂàõÂª∫Êô∫ËÉΩË°®Ê†º
                </div>
                <button class="modal-close" onclick="closeUploadExcelDialog()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="upload-area" id="upload-area">
                    <input type="file" id="excel-file-input" accept=".xlsx,.xls" style="display: none;" onchange="handleFileSelect(event)">
                    <div class="upload-placeholder" onclick="document.getElementById('excel-file-input').click()" 
                         style="cursor: pointer; padding: 60px 20px; text-align: center; border: 2px dashed var(--grey-300); border-radius: 12px; background: var(--grey-50);">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: var(--primary); margin-bottom: 16px; display: block;"></i>
                        <p style="font-size: 16px; margin-bottom: 8px; color: var(--grey-900);">ÁÇπÂáªÊàñÊãñÊãΩ Excel Êñá‰ª∂Âà∞Ê≠§Â§Ñ</p>
                        <p style="font-size: 14px; color: var(--grey-500);">ÊîØÊåÅ .xlsx Âíå .xls Ê†ºÂºè</p>
                    </div>
                </div>

                <!-- Excel È¢ÑËßàÂå∫ -->
                <div id="excel-preview-area" style="display: none; margin-top: 20px;">
                    <div class="form-group">
                        <label class="form-label">Ë°®Ê†ºÂêçÁß∞</label>
                        <input type="text" class="form-control" id="spreadsheet-name" placeholder="ËØ∑ËæìÂÖ•Ë°®Ê†ºÂêçÁß∞">
                    </div>

                    <div style="margin: 20px 0;">
                        <h4 style="margin-bottom: 12px; font-size: 14px; font-weight: 600; color: var(--grey-900);">Êï∞ÊçÆÈ¢ÑËßà</h4>
                        <div class="table-container" id="excel-preview-table" style="max-height: 300px; overflow: auto;">
                            <!-- Âä®ÊÄÅÂä†ËΩΩÈ¢ÑËßàË°®Ê†º -->
                        </div>
                        <p style="margin-top: 12px; font-size: 14px; color: var(--grey-500);" id="excel-info">
                            <!-- Êñá‰ª∂‰ø°ÊÅØ -->
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer" id="excel-modal-footer" style="display: none;">
                <button class="btn btn-outlined" onclick="closeUploadExcelDialog()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="createSpreadsheetFromExcel()">
                    <i class="fas fa-check"></i> ÂàõÂª∫Ë°®Ê†º
                </button>
            </div>
        </div>
    </div>

    <!-- Ë°®Ê†ºËØ¶ÊÉÖÂØπËØùÊ°Ü -->
    <div id="spreadsheet-detail-modal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-table"></i>
                    <span id="spreadsheet-detail-title">Ë°®Ê†ºËØ¶ÊÉÖ</span>
                </div>
                <button class="modal-close" onclick="closeSpreadsheetDetail()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="spreadsheet-info" id="spreadsheet-info">
                    <!-- Âä®ÊÄÅÂä†ËΩΩ -->
                </div>

                <div style="margin: 24px 0;">
                    <h4 style="margin-bottom: 12px; font-size: 16px; font-weight: 600; color: var(--grey-900);">Ë°®Ê†ºÊï∞ÊçÆ</h4>
                    <div class="table-container" id="spreadsheet-data-table" style="max-height: 400px; overflow: auto;">
                        <!-- Âä®ÊÄÅÂä†ËΩΩ -->
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="justify-content: space-between;">
                <button class="btn btn-danger" onclick="deleteSpreadsheet()">
                    <i class="fas fa-trash"></i> Âà†Èô§
                </button>
                <div style="display: flex; gap: 8px;">
                    <button class="btn btn-outlined" onclick="syncSpreadsheet()">
                        <i class="fas fa-sync-alt"></i> ÊâãÂä®ÂêåÊ≠•
                    </button>
                    <button class="btn btn-primary" onclick="openInWecom()">
                        <i class="fas fa-external-link-alt"></i> Âú®‰ºÅ‰∏öÂæÆ‰ø°‰∏≠ÊâìÂºÄ
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ‰ºÅ‰∏öÊ†áÁ≠æÈÄâÊã©Âô®ÂºπÁ™ó -->
    <div id="tag-selector-modal" class="modal" style="display: none;">
        <div class="modal-dialog" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-tags"></i>
                    ÈÄâÊã©‰ºÅ‰∏öÊ†áÁ≠æ
                </h3>
                <button class="modal-close" onclick="closeTagSelector()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 16px;">
                    <input type="text" class="form-control" id="tag-search" placeholder="ÊêúÁ¥¢Ê†áÁ≠æ..." onkeyup="searchTags()">
                </div>
                <div id="tag-groups-list" style="max-height: 400px; overflow-y: auto;">
                    <!-- Âä®ÊÄÅÂä†ËΩΩÊ†áÁ≠æÁªÑ -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outlined" onclick="closeTagSelector()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="confirmTagSelection()">
                    <i class="fas fa-check"></i> Á°ÆÂÆö
                </button>
            </div>
        </div>
    </div>
    
    <!-- ÁúÅ‰ªΩÈÄâÊã©Âô®ÂºπÁ™ó -->
    <div id="province-selector-modal" class="modal" style="display: none;">
        <div class="modal-dialog" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-map-marker-alt"></i>
                    ÈÄâÊã©ÁúÅ‰ªΩ
                </h3>
                <button class="modal-close" onclick="closeProvinceSelector()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 16px;">
                    <input type="text" class="form-control" id="province-search" placeholder="ÊêúÁ¥¢ÁúÅ‰ªΩ..." onkeyup="searchProvinces()">
                </div>
                <div id="provinces-list" style="max-height: 400px; overflow-y: auto;">
                    <!-- Âä®ÊÄÅÂä†ËΩΩÁúÅ‰ªΩÂàóË°® -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outlined" onclick="closeProvinceSelector()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="confirmProvinceSelection()">
                    <i class="fas fa-check"></i> Á°ÆÂÆö
                </button>
            </div>
        </div>
    </div>
    
    <!-- ÂÆ¢Êà∑Áæ§ÂêåÊ≠•ËøõÂ∫¶ÂºπÁ™ó -->
    <div id="group-sync-progress-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-sync fa-spin"></i> Ê≠£Âú®ÂêåÊ≠•ÂÆ¢Êà∑Áæ§
                </h3>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 24px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span id="group-sync-status-text" style="color: var(--grey-700); font-size: 14px;">ÂáÜÂ§á‰∏≠...</span>
                        <span id="group-sync-progress-text" style="color: var(--primary-main); font-weight: 600;">0%</span>
                    </div>
                    <div style="background: var(--grey-200); height: 10px; border-radius: 10px; overflow: hidden;">
                        <div id="group-sync-progress-bar" style="width: 0%; height: 100%; background: var(--gradient-primary); transition: width 0.3s;"></div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 24px;">
                    <div style="background: var(--grey-50); padding: 16px; border-radius: 8px;">
                        <div style="color: var(--grey-600); font-size: 12px; margin-bottom: 4px;">ÊÄªÊï∞</div>
                        <div style="color: var(--grey-900); font-size: 24px; font-weight: 600;" id="group-sync-total">0</div>
                    </div>
                    <div style="background: var(--grey-50); padding: 16px; border-radius: 8px;">
                        <div style="color: var(--grey-600); font-size: 12px; margin-bottom: 4px;">Â∑≤Â§ÑÁêÜ</div>
                        <div style="color: var(--primary-main); font-size: 24px; font-weight: 600;" id="group-sync-processed">0</div>
                    </div>
                    <div style="background: rgba(34, 197, 94, 0.1); padding: 16px; border-radius: 8px;">
                        <div style="color: var(--success); font-size: 12px; margin-bottom: 4px;">Êñ∞Â¢û</div>
                        <div style="color: var(--success); font-size: 24px; font-weight: 600;" id="group-sync-added">0</div>
                    </div>
                    <div style="background: rgba(33, 150, 243, 0.1); padding: 16px; border-radius: 8px;">
                        <div style="color: var(--secondary-main); font-size: 12px; margin-bottom: 4px;">Êõ¥Êñ∞</div>
                        <div style="color: var(--secondary-main); font-size: 24px; font-weight: 600;" id="group-sync-updated">0</div>
                    </div>
                </div>
                
                <div id="group-sync-error" style="display: none; padding: 12px; background: var(--error-light); border-radius: 8px; color: var(--error); font-size: 14px; margin-top: 16px;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outlined" onclick="cancelGroupSync()" id="group-sync-cancel-btn">
                    <i class="fas fa-times"></i> ÂèñÊ∂àÂêåÊ≠•
                </button>
                <button class="btn btn-primary" onclick="closeGroupSyncProgress()" id="group-sync-close-btn" style="display: none;">
                    <i class="fas fa-check"></i> ÂÆåÊàê
                </button>
            </div>
        </div>
    </div>
    
    <!-- Êñ∞Âª∫/ÁºñËæëÊ†áÁ≠æÁªÑÂØπËØùÊ°Ü -->
    <div id="group-tag-dialog" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="group-tag-dialog-title">ÈÄâÊã©Ê†áÁ≠æ</h2>
                <button class="modal-close" onclick="closeGroupTagDialog()">√ó</button>
            </div>
            <div class="modal-body">
                <div id="dialog-tags-container" style="max-height: 400px; overflow-y: auto;">
                    <!-- Ê†áÁ≠æÈÄâÊã©Âå∫ÂüüÂ∞ÜÂä®ÊÄÅÂä†ËΩΩ -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outlined" onclick="closeGroupTagDialog()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="saveGroupTags()">Á°ÆÂÆö</button>
            </div>
        </div>
    </div>
    
    <!-- Êñ∞Âª∫/ÁºñËæëÊ†áÁ≠æÁªÑÂØπËØùÊ°Ü -->
    <div id="group-tag-edit-dialog" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="group-tag-edit-dialog-title">Êñ∞Âª∫Ê†áÁ≠æÁªÑ</h2>
                <button class="modal-close" onclick="closeGroupTagEditDialog()">√ó</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="group-tag-group-id">
                
                <div class="form-group">
                    <label for="group-tag-group-name">Ê†áÁ≠æÁªÑÂêçÁß∞ <span style="color: var(--error);">*</span></label>
                    <input type="text" id="group-tag-group-name" class="form-control" placeholder="‰æãÂ¶ÇÔºöÂÆ¢Êà∑Áæ§ÂàÜÁ±ª">
                </div>
                
                <div class="form-group">
                    <label for="group-tag-order">ÊéíÂ∫èÔºàÊï∞Â≠óË∂äÂ∞èË∂äÈù†ÂâçÔºâ</label>
                    <input type="number" id="group-tag-order" class="form-control" value="1" min="0">
                </div>
                
                <div class="form-group">
                    <label>Ê†áÁ≠æÂàóË°®</label>
                    <div id="group-tag-tags-container" style="margin-bottom: 12px;">
                        <!-- Ê†áÁ≠æËæìÂÖ•Ê°ÜÂ∞ÜÂä®ÊÄÅÊ∑ªÂä† -->
                    </div>
                    <button type="button" class="btn btn-outlined btn-sm" onclick="addTagInput()">
                        <i class="fas fa-plus"></i> Ê∑ªÂä†Ê†áÁ≠æ
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outlined" onclick="closeGroupTagEditDialog()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="saveGroupTag()">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>
    
    <!-- ÁºñËæëÂçï‰∏™Ê†áÁ≠æÂØπËØùÊ°Ü -->
    <div id="edit-tag-dialog" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>ÁºñËæëÊ†áÁ≠æ</h2>
                <button class="modal-close" onclick="closeEditTagDialog()">√ó</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-tag-id">
                <input type="hidden" id="edit-tag-group-id">
                
                <div class="form-group">
                    <label for="edit-tag-name">Ê†áÁ≠æÂêçÁß∞ <span style="color: var(--error);">*</span></label>
                    <input type="text" id="edit-tag-name" class="form-control" placeholder="ËØ∑ËæìÂÖ•Ê†áÁ≠æÂêçÁß∞">
                </div>
                
                <div class="form-group">
                    <label for="edit-tag-order">ÊéíÂ∫è</label>
                    <input type="number" id="edit-tag-order" class="form-control" value="1" min="0">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outlined" onclick="closeEditTagDialog()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="saveEditTag()">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>
    
    <script src="/static/script.js?v=20260126004"></script>
<script src="/static/wecom-bot.js?v=20260126026"></script>
    <script src="/static/group-tags-v2.js?v=20260125010"></script>
    <script>
        // ========== ÂàùÂßãÂåñÊ£ÄÊü• ==========
        console.log('[DEBUG] toggleNavGroup:', typeof window.toggleNavGroup);
        console.log('[DEBUG] showGroupTagDialog:', typeof window.showGroupTagDialog);
        console.log('[DEBUG] showBatchTagDialog:', typeof window.showBatchTagDialog);
        
        // ========== ÂÆ¢Êà∑Áæ§Ê†áÁ≠æÊ®°ÂùóÊ£ÄÊü• ==========
        console.log('[ÂàùÂßãÂåñ] Ê£ÄÊü• group-tags.js ÊòØÂê¶Âä†ËΩΩ...');
        console.log('[ÂàùÂßãÂåñ] loadGroupTags Á±ªÂûã:', typeof window.loadGroupTags);
        console.log('[ÂàùÂßãÂåñ] syncGroupTags Á±ªÂûã:', typeof window.syncGroupTags);
        
        // Â¶ÇÊûúÂáΩÊï∞‰∏çÂ≠òÂú®ÔºåÁ≠âÂæÖËÑöÊú¨Âä†ËΩΩ
        if (typeof window.loadGroupTags === 'undefined') {
            console.warn('[Ë≠¶Âëä] group-tags.js Êú™Ê≠£Á°ÆÂä†ËΩΩÔºåÂ∞ùËØïÈáçÊñ∞Âä†ËΩΩ...');
            const script = document.createElement('script');
            script.src = '/static/group-tags.js?t=' + new Date().getTime();
            script.onload = () => {
                console.log('[ÂàùÂßãÂåñ] group-tags.js ÈáçÊñ∞Âä†ËΩΩÊàêÂäü');
            };
            script.onerror = () => {
                console.error('[ÈîôËØØ] group-tags.js Âä†ËΩΩÂ§±Ë¥•');
            };
            document.body.appendChild(script);
        }
        
        // ========== ÂÆ¢Êà∑ÁîªÂÉèÊ®°ÂùóÔºàÂÜÖËÅî‰ª£Á†ÅÔºâ==========

        // Âä†ËΩΩÂÆ¢Êà∑ÁîªÂÉèÊï∞ÊçÆ
        async function loadCustomerPortrait() {
            console.log('[ÂÆ¢Êà∑ÁîªÂÉè] ÂºÄÂßãÂä†ËΩΩÊï∞ÊçÆ...');
            try {
                initYearSelector(); // ÂàùÂßãÂåñÂπ¥‰ªΩÈÄâÊã©Âô®
                await loadTagStats();
                await loadProvinceStats();
                await loadAddWayStats();
                await loadGenderStats();
                await loadTimeStats();
                await loadMonthlyGrowth();
                await loadEmployeeRanking();
                await loadHotCombinations();
                console.log('[ÂÆ¢Êà∑ÁîªÂÉè] ÊâÄÊúâÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
            } catch (error) {
                console.error('[ÂÆ¢Êà∑ÁîªÂÉè] Âä†ËΩΩÂ§±Ë¥•:', error);
            }
        }

        // Âä†ËΩΩÊ†áÁ≠æÁªüËÆ°
        async function loadTagStats() {
            try {
                const response = await fetch(`/api/customer-portrait/tag-stats?api_token=${apiToken}`);
                const result = await response.json();
                
                if (result.success) {
                    const keyTags = result.data.key_tags;
                    // ‰øÆÂ§çÔºöÊõ¥Êñ∞ÈÄâÊã©Âô®ÔºåÂåπÈÖçÊñ∞ÁöÑ class ÂêçÁß∞
                    document.querySelector('#stat-user .stat-value-minimal').textContent = keyTags['Áî®Êà∑Ê†áÁ≠æ'] + '‰∫∫';
                    document.querySelector('#stat-agent .stat-value-minimal').textContent = keyTags['‰ª£ÁêÜÂïÜ'] + '‰∫∫';
                    document.querySelector('#stat-partner .stat-value-minimal').textContent = keyTags['Âêà‰ºô‰∫∫'] + '‰∫∫';
                    document.querySelector('#stat-supplier .stat-value-minimal').textContent = keyTags['‰æõÂ∫îÂïÜ'] + '‰∫∫';
                    document.querySelector('#stat-peer .stat-value-minimal').textContent = keyTags['ÂêåË°å'] + '‰∫∫';
                    document.querySelector('#stat-old-agent .stat-value-minimal').textContent = keyTags['ÂéüÊúâËÄÅ‰ª£ÁêÜ'] + '‰∫∫';
                }
            } catch (error) {
                console.error('[Ê†áÁ≠æÁªüËÆ°] Â§±Ë¥•:', error);
            }
        }

        // Âä†ËΩΩÁúÅ‰ªΩÁªüËÆ°
        async function loadProvinceStats() {
            try {
                const response = await fetch(`/api/customer-portrait/province-stats?api_token=${apiToken}`);
                const result = await response.json();
                
                if (result.success) {
                    const provinceList = document.getElementById('province-list');
                    const provinces = result.data;
                    
                    if (Object.keys(provinces).length === 0) {
                        provinceList.innerHTML = '<div style="color: #637381; padding: 20px; font-size: 14px;">ÊöÇÊó†ÁúÅ‰ªΩÊï∞ÊçÆ</div>';
                        return;
                    }
                    
                    // Minimal È£éÊ†ºÈÖçËâ≤
                    const colors = [
                        { bg: 'rgba(0, 184, 217, 0.16)', text: '#006C9C' },
                        { bg: 'rgba(255, 171, 0, 0.16)', text: '#B76E00' },
                        { bg: 'rgba(255, 86, 48, 0.16)', text: '#B71D18' },
                        { bg: 'rgba(54, 179, 126, 0.16)', text: '#118D57' },
                        { bg: 'rgba(94, 53, 177, 0.16)', text: '#4527A0' },
                        { bg: 'rgba(0, 167, 111, 0.16)', text: '#005249' },
                        { bg: 'rgba(99, 115, 129, 0.16)', text: '#454F5B' }
                    ];
                    
                    let html = '';
                    let colorIndex = 0;
                    
                    for (const [province, count] of Object.entries(provinces)) {
                        const color = colors[colorIndex % colors.length];
                        html += `<div class="province-tag" onclick="showCustomersByProvince('${province}')" style="background: ${color.bg}; color: ${color.text}; cursor: pointer;">${province}<span class="count" style="color: ${color.text};">${count}‰∫∫</span></div>`;
                        colorIndex++;
                    }
                    
                    provinceList.innerHTML = html;
                }
            } catch (error) {
                console.error('[ÁúÅ‰ªΩÁªüËÆ°] Â§±Ë¥•:', error);
            }
        }

        // Âä†ËΩΩÊ∑ªÂä†ÊñπÂºèÁªüËÆ°
        async function loadAddWayStats() {
            try {
                const response = await fetch(`/api/customer-portrait/add-way-stats?api_token=${apiToken}`);
                const result = await response.json();
                
                if (result.success) {
                    renderPieChart('add-way-chart', result.data.items, 'way', 'count');
                }
            } catch (error) {
                console.error('[Ê∑ªÂä†ÊñπÂºèÁªüËÆ°] Â§±Ë¥•:', error);
            }
        }

        // Âä†ËΩΩÊÄßÂà´ÁªüËÆ°
        async function loadGenderStats() {
            try {
                const response = await fetch(`/api/customer-portrait/gender-stats?api_token=${apiToken}`);
                const result = await response.json();
                
                if (result.success) {
                    renderPieChart('gender-chart', result.data.items, 'gender', 'count');
                }
            } catch (error) {
                console.error('[ÊÄßÂà´ÁªüËÆ°] Â§±Ë¥•:', error);
            }
        }

        // Âä†ËΩΩÊó∂Èó¥Áª¥Â∫¶ÁªüËÆ°
        async function loadTimeStats() {
            try {
                const response = await fetch(`/api/customer-portrait/time-stats?api_token=${apiToken}`);
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    const container = document.getElementById('time-stats-chart');
                    
                    const timeItems = [
                        { label: '‰ªäÊó•Êñ∞Â¢û', value: data.today, color: '#00B8D9', bgColor: 'rgba(0, 184, 217, 0.12)', icon: 'üìÖ' },
                        { label: 'Êò®Êó•Êñ∞Â¢û', value: data.yesterday, color: '#637381', bgColor: 'rgba(99, 115, 129, 0.12)', icon: 'üìÜ' },
                        { label: 'Êú¨Âë®Êñ∞Â¢û', value: data.this_week, color: '#FFAB00', bgColor: 'rgba(255, 171, 0, 0.12)', icon: 'üìä' },
                        { label: '‰∏äÂë®Êñ∞Â¢û', value: data.last_week, color: '#B78103', bgColor: 'rgba(183, 129, 3, 0.12)', icon: 'üìà' },
                        { label: 'Êú¨ÊúàÊñ∞Â¢û', value: data.this_month, color: '#36B37E', bgColor: 'rgba(54, 179, 126, 0.12)', icon: 'üóìÔ∏è' },
                        { label: '‰∏äÊúàÊñ∞Â¢û', value: data.last_month, color: '#5E35B1', bgColor: 'rgba(94, 53, 177, 0.12)', icon: 'üìÖ' }
                    ];
                    
                    let html = '';
                    timeItems.forEach(item => {
                        html += `
                            <div style="
                                padding: 20px; 
                                background: ${item.bgColor}; 
                                border-radius: 12px; 
                                border: 2px solid transparent;
                                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                                cursor: pointer;
                            " 
                            onmouseenter="this.style.borderColor='${item.color}'; this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 16px rgba(145, 158, 171, 0.16)';"
                            onmouseleave="this.style.borderColor='transparent'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                                    <span style="font-size: 24px; line-height: 1;">${item.icon}</span>
                                    <span style="font-size: 13px; color: #637381; font-weight: 600;">${item.label}</span>
                                </div>
                                <div style="font-size: 28px; font-weight: 800; color: ${item.color}; line-height: 1;">
                                    ${item.value.toLocaleString()}
                                </div>
                                <div style="font-size: 11px; color: #919EAB; margin-top: 4px;">
                                    ‰∫∫
                                </div>
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                }
            } catch (error) {
                console.error('[Êó∂Èó¥ÁªüËÆ°] Â§±Ë¥•:', error);
            }
        }

        // Ê∏≤ÊüìÈ•ºÂõæÔºàMinimal È£éÊ†ºÔºâ
        function renderPieChart(containerId, data, labelKey, valueKey) {
            const container = document.getElementById(containerId);
            if (!container || !data || data.length === 0) {
                if (container) container.innerHTML = '<div style="color: #919EAB; padding: 50px; text-align: center; font-size: 14px;">ÊöÇÊó†Êï∞ÊçÆ</div>';
                return;
            }
            
            const total = data.reduce((sum, item) => sum + item[valueKey], 0);
            
            // Minimal ÈÖçËâ≤ÊñπÊ°àÔºö‰ΩéÈ•±ÂíåÂ∫¶‰∏ì‰∏öËâ≤
            const colors = [
                '#00B8D9', // info
                '#FFAB00', // warning
                '#FF5630', // error
                '#36B37E', // success
                '#5E35B1', // purple
                '#00A76F', // primary
                '#637381', // grey
                '#078DEE'  // blue
            ];
            
            // Âà§Êñ≠ÊòØÊ∑ªÂä†ÊñπÂºèËøòÊòØÊÄßÂà´
            const isAddWay = containerId === 'add-way-chart';
            const isGender = containerId === 'gender-chart';
            
            // ‰ΩøÁî®3ÂàóÁΩëÊ†ºÂ∏ÉÂ±Ä
            let html = `<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">`;
            
            // Âè™ÊòæÁ§∫Ââç9Êù°Êï∞ÊçÆÔºà3x3Ê≠£Â•ΩÔºâ
            const displayData = data.slice(0, 9);
            
            displayData.forEach((item, index) => {
                const color = colors[index % colors.length];
                const percentage = ((item[valueKey] / total) * 100).toFixed(1);
                
                // Âà§Êñ≠ÊòØÊ∑ªÂä†ÊñπÂºèËøòÊòØÊÄßÂà´ÔºåÊ∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
                const clickHandler = isAddWay 
                    ? `onclick="showCustomersByAddWay('${item[labelKey].replace(/'/g, "\\'")}')"` 
                    : isGender 
                    ? `onclick="showCustomersByGender('${item[labelKey]}')"` 
                    : '';
                
                html += `
                    <div ${clickHandler} style="position: relative; padding: 14px; background: #FFFFFF; border: 1px solid rgba(145, 158, 171, 0.12); border-radius: 8px; transition: all 0.2s ease; cursor: ${isAddWay || isGender ? 'pointer' : 'default'};" 
                         onmouseover="this.style.borderColor='${color}'; this.style.boxShadow='0 0 2px 0 rgba(145, 158, 171, 0.2), 0 8px 16px -4px rgba(145, 158, 171, 0.12)';" 
                         onmouseout="this.style.borderColor='rgba(145, 158, 171, 0.12)'; this.style.boxShadow='none';">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                            <div style="width: 10px; height: 10px; border-radius: 2px; background: ${color}; flex-shrink: 0;"></div>
                            <div style="font-size: 13px; color: #212B36; font-weight: 600; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1;">
                                ${item[labelKey]}
                            </div>
                        </div>
                        <div style="display: flex; align-items: baseline; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 20px; font-weight: 700; color: #212B36;">
                                ${item[valueKey].toLocaleString()}
                            </span>
                            <span style="font-size: 11px; color: #637381; font-weight: 600;">
                                ${percentage}%
                            </span>
                        </div>
                        <!-- ËøõÂ∫¶Êù° -->
                        <div style="width: 100%; height: 5px; background: rgba(145, 158, 171, 0.12); border-radius: 2.5px; overflow: hidden;">
                            <div style="width: ${percentage}%; height: 100%; background: ${color}; border-radius: 2.5px; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);"></div>
                        </div>
                    </div>
                `;
            });
            
            // Â¶ÇÊûúÊúâÊõ¥Â§öÊï∞ÊçÆÔºåÊòæÁ§∫"ÂÖ∂‰ªñ"
            if (data.length > 9) {
                const othersCount = data.slice(9).reduce((sum, item) => sum + item[valueKey], 0);
                const othersPercentage = ((othersCount / total) * 100).toFixed(1);
                
                html += `
                    <div style="padding: 14px; background: #F4F6F8; border: 1px solid rgba(145, 158, 171, 0.08); border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                            <div style="width: 10px; height: 10px; border-radius: 2px; background: #919EAB; flex-shrink: 0;"></div>
                            <div style="font-size: 13px; color: #637381; font-weight: 600;">
                                ÂÖ∂‰ªñ (${data.length - 9})
                            </div>
                        </div>
                        <div style="display: flex; align-items: baseline; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 20px; font-weight: 700; color: #212B36;">
                                ${othersCount.toLocaleString()}
                            </span>
                            <span style="font-size: 11px; color: #637381; font-weight: 600;">
                                ${othersPercentage}%
                            </span>
                        </div>
                        <div style="width: 100%; height: 5px; background: rgba(145, 158, 171, 0.12); border-radius: 2.5px; overflow: hidden;">
                            <div style="width: ${othersPercentage}%; height: 100%; background: #919EAB; border-radius: 2.5px;"></div>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Âà∑Êñ∞ÂÆ¢Êà∑ÁîªÂÉè
        function refreshCustomerPortrait() {
            loadCustomerPortrait();
            loadMonthlyGrowth();
            loadEmployeeRanking();
            loadHotCombinations();
        }

        // ========== Ê®°Âùó2ÔºöÊúàÂ∫¶Â¢ûÈïøË∂ãÂäø ==========
        let monthlyGrowthChart = null;
        
        // ÂàùÂßãÂåñÂπ¥‰ªΩÈÄâÊã©Âô®
        function initYearSelector() {
            const yearSelect = document.getElementById('growth-year-filter');
            const currentYear = new Date().getFullYear();
            
            // ÁîüÊàêÊúÄËøë5Âπ¥ÁöÑÈÄâÈ°π
            for (let i = 0; i < 5; i++) {
                const year = currentYear - i;
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + 'Âπ¥';
                if (i === 0) option.selected = true; // ÈªòËÆ§ÈÄâÊã©ÂΩìÂâçÂπ¥‰ªΩ
                yearSelect.appendChild(option);
            }
            
            // Ê∑ªÂä†"ÊúÄËøë12‰∏™Êúà"ÈÄâÈ°π
            const recentOption = document.createElement('option');
            recentOption.value = 'recent12';
            recentOption.textContent = 'ÊúÄËøë12‰∏™Êúà';
            recentOption.selected = true; // ÈªòËÆ§ÈÄâÊã©ÊúÄËøë12‰∏™Êúà
            yearSelect.insertBefore(recentOption, yearSelect.firstChild);
        }
        
        async function loadMonthlyGrowth() {
            const yearFilter = document.getElementById('growth-year-filter').value;
            const tagType = document.getElementById('growth-tag-filter').value;
            
            try {
                let months = 12;
                let apiUrl = '';
                
                if (yearFilter === 'recent12') {
                    // ÊúÄËøë12‰∏™ÊúàÔºàÂåÖÂê´Êú¨ÊúàÔºâ
                    apiUrl = `/api/customer-portrait/monthly-growth?tag_type=${tagType}&months=12&api_token=${apiToken}`;
                } else {
                    // ÊåáÂÆöÂπ¥‰ªΩÔºà1-12ÊúàÔºâ
                    apiUrl = `/api/customer-portrait/monthly-growth-by-year?tag_type=${tagType}&year=${yearFilter}&api_token=${apiToken}`;
                }
                
                const response = await fetch(apiUrl);
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    
                    // Êõ¥Êñ∞ÁªüËÆ°Âç°Áâá
                    document.getElementById('growth-total').textContent = data.total_growth.toLocaleString();
                    document.getElementById('growth-avg').textContent = data.avg_growth.toLocaleString();
                    document.getElementById('growth-max').textContent = data.max_month ? `${data.max_month.display} (${data.max_month.count}‰∫∫)` : '-';
                    document.getElementById('growth-min').textContent = data.min_month ? `${data.min_month.display} (${data.min_month.count}‰∫∫)` : '-';
                    
                    // ÁªòÂà∂ÂõæË°®
                    const ctx = document.getElementById('monthly-growth-chart');
                    
                    // ÈîÄÊØÅÊóßÂõæË°®
                    if (monthlyGrowthChart) {
                        monthlyGrowthChart.destroy();
                    }
                    
                    monthlyGrowthChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: data.months.map(m => m.display),
                            datasets: [{
                                label: 'Êñ∞Â¢ûÂÆ¢Êà∑Êï∞',
                                data: data.months.map(m => m.count),
                                borderColor: '#00B8D9',
                                backgroundColor: 'rgba(0, 184, 217, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.4,
                                pointRadius: 4,
                                pointHoverRadius: 6,
                                pointBackgroundColor: '#00B8D9',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(33, 43, 54, 0.9)',
                                    titleColor: '#fff',
                                    bodyColor: '#fff',
                                    borderColor: 'rgba(145, 158, 171, 0.24)',
                                    borderWidth: 1,
                                    padding: 12,
                                    displayColors: false,
                                    callbacks: {
                                        label: function(context) {
                                            return 'Êñ∞Â¢ûÂÆ¢Êà∑Ôºö' + context.parsed.y + '‰∫∫';
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        color: '#637381',
                                        font: {
                                            size: 12
                                        }
                                    },
                                    grid: {
                                        color: 'rgba(145, 158, 171, 0.08)',
                                        drawBorder: false
                                    }
                                },
                                x: {
                                    ticks: {
                                        color: '#637381',
                                        font: {
                                            size: 12
                                        },
                                        maxRotation: 45,
                                        minRotation: 45
                                    },
                                    grid: {
                                        display: false,
                                        drawBorder: false
                                    }
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('[ÊúàÂ∫¶Â¢ûÈïø] Âä†ËΩΩÂ§±Ë¥•:', error);
            }
        }

        // ========== Ê®°Âùó3ÔºöÂëòÂ∑•ÊéíË°åÊ¶ú ==========
        let currentEmployeeCustomers = [];
        
        async function loadEmployeeRanking() {
            const tagType = document.getElementById('ranking-tag-filter').value;
            const container = document.getElementById('employee-ranking-list');
            
            container.innerHTML = '<div style="color: #637381; padding: 40px; text-align: center; font-size: 14px;">Âä†ËΩΩ‰∏≠...</div>';
            
            try {
                const response = await fetch(`/api/customer-portrait/employee-ranking?tag_type=${tagType}&limit=20&api_token=${apiToken}`);
                const result = await response.json();
                
                if (result.success) {
                    const ranking = result.data.ranking;
                    
                    if (ranking.length === 0) {
                        container.innerHTML = '<div style="color: #637381; padding: 40px; text-align: center; font-size: 14px;">ÊöÇÊó†Êï∞ÊçÆ</div>';
                        return;
                    }
                    
                    let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px;">';
                    
                    ranking.forEach((item, index) => {
                        // ÊéíÂêçÈ¢úËâ≤
                        let rankColor = '#637381';
                        let rankBg = 'rgba(145, 158, 171, 0.12)';
                        let rankIcon = '';
                        if (index === 0) {
                            rankColor = '#FFAB00';
                            rankBg = 'rgba(255, 171, 0, 0.12)';
                            rankIcon = 'ü•á';
                        } else if (index === 1) {
                            rankColor = '#919EAB';
                            rankBg = 'rgba(145, 158, 171, 0.16)';
                            rankIcon = 'ü•à';
                        } else if (index === 2) {
                            rankColor = '#B78103';
                            rankBg = 'rgba(183, 129, 3, 0.12)';
                            rankIcon = 'ü•â';
                        }
                        
                        html += `
                            <div style="padding: 20px; background: #FFFFFF; border: 1px solid rgba(145, 158, 171, 0.12); border-radius: 12px; transition: all 0.2s; cursor: pointer;"
                                 onmouseover="this.style.borderColor='${rankColor}'; this.style.boxShadow='0 0 2px 0 rgba(145, 158, 171, 0.2), 0 8px 16px rgba(145, 158, 171, 0.12)'"
                                 onmouseout="this.style.borderColor='rgba(145, 158, 171, 0.12)'; this.style.boxShadow='none'"
                                 onclick="showEmployeeCustomers('${item.userid}', '${item.name}', '${tagType}')">
                                <div style="display: flex; align-items: center; margin-bottom: 16px;">
                                    <div style="width: 36px; height: 36px; background: ${rankBg}; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; color: ${rankColor}; flex-shrink: 0;">
                                        ${rankIcon ? rankIcon : item.rank}
                                    </div>
                                    <div style="flex: 1; margin-left: 12px; min-width: 0;">
                                        <div style="font-size: 14px; font-weight: 600; color: #212B36; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                            ${item.name}
                                        </div>
                                        <div style="font-size: 11px; color: #637381; margin-top: 2px;">
                                            ÊéíÂêç #${item.rank}
                                        </div>
                                    </div>
                                </div>
                                <div style="margin-bottom: 12px;">
                                    <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 6px;">
                                        <span style="font-size: 12px; color: #637381;">ÂÆ¢Êà∑Êï∞</span>
                                        <span style="font-size: 24px; font-weight: 700; color: #00B8D9;">${item.count}</span>
                                    </div>
                                    <div style="width: 100%; height: 6px; background: rgba(145, 158, 171, 0.12); border-radius: 3px; overflow: hidden;">
                                        <div style="width: ${item.percentage}%; height: 100%; background: linear-gradient(90deg, #00B8D9 0%, #00A76F 100%); border-radius: 3px; transition: width 0.3s ease;"></div>
                                    </div>
                                </div>
                                <div style="text-align: center; padding: 8px; background: rgba(0, 184, 217, 0.08); border-radius: 6px;">
                                    <span style="font-size: 13px; font-weight: 600; color: #00B8D9;">Âç†ÊØî ${item.percentage}%</span>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    container.innerHTML = html;
                }
            } catch (error) {
                console.error('[ÂëòÂ∑•ÊéíË°åÊ¶ú] Âä†ËΩΩÂ§±Ë¥•:', error);
                container.innerHTML = '<div style="color: #FF5630; padding: 40px; text-align: center; font-size: 14px;">Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑ÈáçËØï</div>';
            }
        }
        
        // ÊòæÁ§∫ÂëòÂ∑•ÁöÑÂÆ¢Êà∑ÂàóË°®
        async function showEmployeeCustomers(userid, name, tagType) {
            const modal = document.getElementById('customer-list-modal');
            const title = document.getElementById('customer-modal-title');
            const content = document.getElementById('customer-list-content');
            
            title.textContent = `${name} - ÂÆ¢Êà∑ÂàóË°®`;
            modal.style.display = 'flex';
            
            content.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #637381;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 32px; margin-bottom: 16px;"></i>
                    <div>Âä†ËΩΩ‰∏≠...</div>
                </div>
            `;
            
            try {
                // ËøôÈáåÈúÄË¶ÅÊ∑ªÂä†‰∏Ä‰∏™Êñ∞ÁöÑAPIÊù•ÊåâÂëòÂ∑•Êü•ËØ¢ÂÆ¢Êà∑
                // ÊöÇÊó∂‰ΩøÁî®Ê†áÁ≠æÁ≠õÈÄâAPI
                const response = await fetch(`/api/customer-portrait/customers-by-tag?tag_type=${tagType}&page=1&limit=100&api_token=${apiToken}`);
                const result = await response.json();
                
                if (result.success) {
                    // Á≠õÈÄâÂá∫ËØ•ÂëòÂ∑•ÁöÑÂÆ¢Êà∑
                    const employeeCustomers = result.data.customers.filter(c => c.owner_userid === userid);
                    
                    renderCustomerList({
                        customers: employeeCustomers,
                        total: employeeCustomers.length,
                        page: 1,
                        limit: 100,
                        total_pages: 1
                    }, 'employee', name);
                }
            } catch (error) {
                console.error('[ÂëòÂ∑•ÂÆ¢Êà∑ÂàóË°®] Âä†ËΩΩÂ§±Ë¥•:', error);
                content.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #FF5630;">
                        <i class="fas fa-exclamation-circle" style="font-size: 48px; margin-bottom: 16px;"></i>
                        <div>Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑ÈáçËØï</div>
                    </div>
                `;
            }
        }

        // ========== Ê®°Âùó4ÔºöÊ†áÁ≠æÁªÑÂêàÂàÜÊûê ==========
        let combinationCustomers = [];
        
        async function loadHotCombinations() {
            const container = document.getElementById('hot-combinations-list');
            container.innerHTML = '<div style="color: #637381; padding: 20px; font-size: 14px;">Âä†ËΩΩ‰∏≠...</div>';
            
            try {
                const response = await fetch(`/api/customer-portrait/tag-combinations?limit=10&api_token=${apiToken}`);
                const result = await response.json();
                
                if (result.success) {
                    const combinations = result.data.hot_combinations;
                    
                    if (combinations.length === 0) {
                        container.innerHTML = '<div style="color: #637381; padding: 20px; font-size: 14px;">ÊöÇÊó†Êï∞ÊçÆ</div>';
                        return;
                    }
                    
                    let html = '';
                    
                    combinations.forEach((combo, index) => {
                        const color = ['#00B8D9', '#FFAB00', '#FF5630', '#36B37E', '#5E35B1'][index % 5];
                        
                        html += `
                            <div style="padding: 16px; background: white; border: 1px solid rgba(145, 158, 171, 0.12); border-radius: 8px; transition: all 0.2s; cursor: pointer;"
                                 onmouseover="this.style.borderColor='${color}'; this.style.boxShadow='0 0 2px 0 rgba(145, 158, 171, 0.2), 0 4px 8px rgba(145, 158, 171, 0.12)'"
                                 onmouseout="this.style.borderColor='rgba(145, 158, 171, 0.12)'; this.style.boxShadow='none'"
                                 onclick="quickSearchCombination('${combo.tags.join(',')}')">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                    <div style="font-size: 14px; font-weight: 600; color: #212B36;">
                                        ${combo.display}
                                    </div>
                                    <div style="font-size: 18px; font-weight: 700; color: ${color};">
                                        ${combo.count}
                                    </div>
                                </div>
                                <div style="font-size: 12px; color: #637381;">
                                    ÁÇπÂáªÊü•ÁúãÂÆ¢Êà∑ÂàóË°®
                                </div>
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                }
            } catch (error) {
                console.error('[ÁÉ≠Èó®ÁªÑÂêà] Âä†ËΩΩÂ§±Ë¥•:', error);
                container.innerHTML = '<div style="color: #FF5630; padding: 20px; font-size: 14px;">Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑ÈáçËØï</div>';
            }
        }
        
        // ÊêúÁ¥¢Ê†áÁ≠æÁªÑÂêà
        async function searchTagCombination() {
            const input = document.getElementById('combo-tag-input').value.trim();
            if (!input) {
                alert('ËØ∑ËæìÂÖ•Ê†áÁ≠æÂêçÁß∞');
                return;
            }
            
            try {
                const response = await fetch(`/api/customer-portrait/tag-combinations?tags=${encodeURIComponent(input)}&api_token=${apiToken}`);
                const result = await response.json();
                
                if (result.success) {
                    combinationCustomers = result.data.customers;
                    const count = result.data.total;
                    
                    document.getElementById('combo-count').textContent = count;
                    document.getElementById('combo-result').style.display = 'block';
                }
            } catch (error) {
                console.error('[Ê†áÁ≠æÁªÑÂêàÊü•ËØ¢] Â§±Ë¥•:', error);
                alert('Êü•ËØ¢Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
            }
        }
        
        // Âø´ÈÄüÊêúÁ¥¢ÁªÑÂêàÔºàÁÇπÂáªÁÉ≠Èó®ÁªÑÂêàÊó∂Ôºâ
        async function quickSearchCombination(tags) {
            document.getElementById('combo-tag-input').value = tags;
            await searchTagCombination();
            
            // Ëá™Âä®ÊâìÂºÄÂÆ¢Êà∑ÂàóË°®
            if (combinationCustomers.length > 0) {
                showCombinationCustomers();
            }
        }
        
        // ÊòæÁ§∫ÁªÑÂêàÂÆ¢Êà∑ÂàóË°®
        function showCombinationCustomers() {
            if (combinationCustomers.length === 0) {
                alert('Ê≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑÂÆ¢Êà∑');
                return;
            }
            
            // ÊâìÂºÄÊ®°ÊÄÅÊ°Ü
            const modal = document.getElementById('customer-list-modal');
            const title = document.getElementById('customer-modal-title');
            modal.style.display = 'flex';
            title.textContent = 'Ê†áÁ≠æÁªÑÂêà - ÂÆ¢Êà∑ÂàóË°®';
            
            renderCustomerList({
                customers: combinationCustomers,
                total: combinationCustomers.length,
                page: 1,
                limit: 100,
                total_pages: 1
            }, 'combination', 'Ê†áÁ≠æÁªÑÂêà');
        }

        // ÊòæÁ§∫ÊåáÂÆöÊ†áÁ≠æÁöÑÂÆ¢Êà∑ÂàóË°®ÔºàÊîØÊåÅÂàÜÈ°µÔºâ
        let currentTagType = '';
        let currentTagName = '';
        let currentCustomerPage = 1;
        const customerPageLimit = 10;

        async function showCustomersByTag(tagType, tagName, page = 1) {
            currentTagType = tagType;
            currentTagName = tagName;
            currentCustomerPage = page;
            
            const modal = document.getElementById('customer-list-modal');
            const title = document.getElementById('customer-modal-title');
            const content = document.getElementById('customer-list-content');
            
            title.textContent = `${tagName} - ÂÆ¢Êà∑ÂàóË°®`;
            modal.style.display = 'flex';
            
            content.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #637381;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 32px; margin-bottom: 16px;"></i>
                    <div>Âä†ËΩΩ‰∏≠...</div>
                </div>
            `;
            
            try {
                const response = await fetch(`/api/customer-portrait/customers-by-tag?tag_type=${tagType}&page=${page}&limit=${customerPageLimit}&api_token=${apiToken}`);
                const result = await response.json();
                
                if (result.success) {
                    const customers = result.data.customers;
                    const total = result.data.total;
                    const totalPages = result.data.total_pages;
                    
                    if (customers.length === 0) {
                        content.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: #637381;">
                                <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                                <div>ÊöÇÊó†ÂÆ¢Êà∑Êï∞ÊçÆ</div>
                            </div>
                        `;
                        document.getElementById('customer-modal-pagination').innerHTML = '';
                        return;
                    }
                    
                    // Ê∏≤ÊüìÂÆ¢Êà∑ÂàóË°®Ë°®Ê†º
                    let html = `
                        <table style="width: 100%; border-collapse: separate; border-spacing: 0 8px;">
                            <thead>
                                <tr style="background: #F4F6F8;">
                                    <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #637381; border-radius: 8px 0 0 8px;">ÂÆ¢Êà∑Â§¥ÂÉè</th>
                                    <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #637381;">Áî®Êà∑ÊòµÁß∞</th>
                                    <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #637381;">Áî®Êà∑Â§áÊ≥®</th>
                                    <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #637381;">ÊâÄÂ±ûÂëòÂ∑•</th>
                                    <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #637381;">ÊâÄÂ±ûÁæ§</th>
                                    <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #637381;">ÊÄßÂà´</th>
                                    <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #637381;">ÂÆ¢Êà∑Ê†áÁ≠æ</th>
                                    <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #637381; border-radius: 0 8px 8px 0;">Ê∑ªÂä†Êó∂Èó¥</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    customers.forEach((customer, index) => {
                        const genderText = customer.gender === 1 ? 'Áî∑' : customer.gender === 2 ? 'Â•≥' : 'Êú™Áü•';
                        const genderIcon = customer.gender === 1 ? '<i class="fas fa-mars" style="color: #00B8D9; margin-left: 4px;"></i>' : 
                                          customer.gender === 2 ? '<i class="fas fa-venus" style="color: #FF5630; margin-left: 4px;"></i>' : 
                                          '<i class="fas fa-genderless" style="color: #637381; margin-left: 4px;"></i>';
                        
                        const addTime = customer.add_time ? new Date(customer.add_time * 1000).toLocaleString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit' }) : '-';
                        
                        const tags = customer.tags.slice(0, 2).map(tag => 
                            `<span style="display: inline-block; padding: 2px 8px; background: rgba(0, 167, 111, 0.12); color: #005249; border-radius: 4px; font-size: 11px; margin-right: 4px; white-space: nowrap;">${tag}</span>`
                        ).join('');
                        
                        const moreTags = customer.tags.length > 2 ? `<span style="color: #637381; font-size: 11px;">+${customer.tags.length - 2}</span>` : '';
                        
                        html += `
                            <tr style="background: #FFFFFF; border: 1px solid rgba(145, 158, 171, 0.12); transition: all 0.2s;" 
                                onmouseover="this.style.background='#F4F6F8'; this.style.boxShadow='0 0 2px 0 rgba(145, 158, 171, 0.2), 0 4px 8px rgba(145, 158, 171, 0.12)'" 
                                onmouseout="this.style.background='#FFFFFF'; this.style.boxShadow='none'">
                                <td style="padding: 12px 16px; border-radius: 8px 0 0 8px;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, rgba(0, 184, 217, 0.2) 0%, rgba(0, 184, 217, 0.1) 100%); display: flex; align-items: center; justify-content: center; font-size: 18px; color: #00B8D9;">
                                        <i class="fas fa-user"></i>
                                    </div>
                                </td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-size: 14px; font-weight: 600; color: #212B36;">${customer.name || '-'}</div>
                                </td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-size: 13px; color: #637381;">${customer.remark || '-'}</div>
                                </td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-size: 13px; color: #212B36;">${customer.owner_name || customer.owner_userid || '-'}</div>
                                </td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-size: 13px; color: #637381;">-</div>
                                </td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-size: 13px; color: #212B36; display: flex; align-items: center;">
                                        ${genderText}${genderIcon}
                                    </div>
                                </td>
                                <td style="padding: 12px 16px;">
                                    <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 4px;">
                                        ${tags}
                                        ${moreTags}
                                    </div>
                                </td>
                                <td style="padding: 12px 16px; border-radius: 0 8px 8px 0;">
                                    <div style="font-size: 12px; color: #637381; white-space: nowrap;">${addTime}</div>
                                </td>
                            </tr>
                        `;
                    });
                    
                    html += '</tbody></table>';
                    content.innerHTML = html;
                    
                    // Êõ¥Êñ∞ÂàÜÈ°µ‰ø°ÊÅØ
                    renderCustomerPagination(page, totalPages, total);
                } else {
                    content.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #FF5630;">
                            <i class="fas fa-exclamation-circle" style="font-size: 48px; margin-bottom: 16px;"></i>
                            <div>${result.message || 'Âä†ËΩΩÂ§±Ë¥•'}</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Âä†ËΩΩÂÆ¢Êà∑ÂàóË°®Â§±Ë¥•:', error);
                content.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #FF5630;">
                        <i class="fas fa-exclamation-circle" style="font-size: 48px; margin-bottom: 16px;"></i>
                        <div>Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑ÈáçËØï</div>
                    </div>
                `;
            }
        }

        // Ê∏≤ÊüìÂàÜÈ°µÁªÑ‰ª∂
        function renderCustomerPagination(currentPage, totalPages, total) {
            const paginationContainer = document.getElementById('customer-modal-pagination');
            
            let html = `
                <div style="display: flex; align-items: center; gap: 16px;">
                    <span style="font-size: 14px; color: #637381;">ÂÖ± ${total} ‰ΩçÂÆ¢Êà∑</span>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <button onclick="showCustomersByTag('${currentTagType}', '${currentTagName}', ${currentPage - 1})" 
                                ${currentPage === 1 ? 'disabled' : ''}
                                style="padding: 6px 12px; border: 1px solid rgba(145, 158, 171, 0.24); border-radius: 6px; background: white; color: #637381; font-size: 13px; cursor: pointer; transition: all 0.2s;"
                                ${currentPage === 1 ? '' : 'onmouseover="this.style.background=\'#F4F6F8\'" onmouseout="this.style.background=\'white\'"'}>
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span style="font-size: 13px; color: #212B36; font-weight: 600;">${currentPage} / ${totalPages}</span>
                        <button onclick="showCustomersByTag('${currentTagType}', '${currentTagName}', ${currentPage + 1})" 
                                ${currentPage >= totalPages ? 'disabled' : ''}
                                style="padding: 6px 12px; border: 1px solid rgba(145, 158, 171, 0.24); border-radius: 6px; background: white; color: #637381; font-size: 13px; cursor: pointer; transition: all 0.2s;"
                                ${currentPage >= totalPages ? '' : 'onmouseover="this.style.background=\'#F4F6F8\'" onmouseout="this.style.background=\'white\'"'}>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            `;
            
            paginationContainer.innerHTML = html;
        }

        // ÂÖ≥Èó≠ÂÆ¢Êà∑ÂàóË°®ÂºπÁ™ó
        function closeCustomerModal() {
            document.getElementById('customer-list-modal').style.display = 'none';
        }

        // ÂΩìÂâçÁ≠õÈÄâÁä∂ÊÄÅ
        let currentFilterType = '';
        let currentFilterValue = '';
        let currentFilterPage = 1;

        // Ê†πÊçÆÁúÅ‰ªΩÊòæÁ§∫ÂÆ¢Êà∑ÂàóË°®
        async function showCustomersByProvince(province, page = 1) {
            currentFilterType = 'province';
            currentFilterValue = province;
            currentFilterPage = page;
            
            const modal = document.getElementById('customer-list-modal');
            const title = document.getElementById('customer-modal-title');
            const content = document.getElementById('customer-list-content');
            
            title.textContent = `${province} - ÂÆ¢Êà∑ÂàóË°®`;
            modal.style.display = 'flex';
            
            content.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #637381;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 32px; margin-bottom: 16px;"></i>
                    <div>Âä†ËΩΩ‰∏≠...</div>
                </div>
            `;
            
            try {
                const response = await fetch(`/api/customer-portrait/customers-by-filter?filter_type=province&filter_value=${encodeURIComponent(province)}&page=${page}&limit=${customerPageLimit}&api_token=${apiToken}`);
                const result = await response.json();
                
                if (result.success) {
                    renderCustomerList(result.data, 'province', province);
                } else {
                    content.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #FF5630;">
                            <i class="fas fa-exclamation-circle" style="font-size: 48px; margin-bottom: 16px;"></i>
                            <div>${result.message || 'Âä†ËΩΩÂ§±Ë¥•'}</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Âä†ËΩΩÂÆ¢Êà∑ÂàóË°®Â§±Ë¥•:', error);
                content.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #FF5630;">
                        <i class="fas fa-exclamation-circle" style="font-size: 48px; margin-bottom: 16px;"></i>
                        <div>Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑ÈáçËØï</div>
                    </div>
                `;
            }
        }

        // Ê†πÊçÆÊ∑ªÂä†ÊñπÂºèÊòæÁ§∫ÂÆ¢Êà∑ÂàóË°®
        async function showCustomersByAddWay(addWay, page = 1) {
            currentFilterType = 'add_way';
            currentFilterValue = addWay;
            currentFilterPage = page;
            
            const modal = document.getElementById('customer-list-modal');
            const title = document.getElementById('customer-modal-title');
            const content = document.getElementById('customer-list-content');
            
            title.textContent = `${addWay} - ÂÆ¢Êà∑ÂàóË°®`;
            modal.style.display = 'flex';
            
            content.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #637381;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 32px; margin-bottom: 16px;"></i>
                    <div>Âä†ËΩΩ‰∏≠...</div>
                </div>
            `;
            
            try {
                const response = await fetch(`/api/customer-portrait/customers-by-filter?filter_type=add_way&filter_value=${encodeURIComponent(addWay)}&page=${page}&limit=${customerPageLimit}&api_token=${apiToken}`);
                const result = await response.json();
                
                if (result.success) {
                    renderCustomerList(result.data, 'add_way', addWay);
                } else {
                    content.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #FF5630;">
                            <i class="fas fa-exclamation-circle" style="font-size: 48px; margin-bottom: 16px;"></i>
                            <div>${result.message || 'Âä†ËΩΩÂ§±Ë¥•'}</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Âä†ËΩΩÂÆ¢Êà∑ÂàóË°®Â§±Ë¥•:', error);
                content.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #FF5630;">
                        <i class="fas fa-exclamation-circle" style="font-size: 48px; margin-bottom: 16px;"></i>
                        <div>Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑ÈáçËØï</div>
                    </div>
                `;
            }
        }

        // Ê†πÊçÆÊÄßÂà´ÊòæÁ§∫ÂÆ¢Êà∑ÂàóË°®
        async function showCustomersByGender(gender, page = 1) {
            currentFilterType = 'gender';
            currentFilterValue = gender;
            currentFilterPage = page;
            
            const modal = document.getElementById('customer-list-modal');
            const title = document.getElementById('customer-modal-title');
            const content = document.getElementById('customer-list-content');
            
            title.textContent = `ÊÄßÂà´Ôºö${gender} - ÂÆ¢Êà∑ÂàóË°®`;
            modal.style.display = 'flex';
            
            content.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #637381;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 32px; margin-bottom: 16px;"></i>
                    <div>Âä†ËΩΩ‰∏≠...</div>
                </div>
            `;
            
            try {
                const response = await fetch(`/api/customer-portrait/customers-by-filter?filter_type=gender&filter_value=${encodeURIComponent(gender)}&page=${page}&limit=${customerPageLimit}&api_token=${apiToken}`);
                const result = await response.json();
                
                if (result.success) {
                    renderCustomerList(result.data, 'gender', gender);
                } else {
                    content.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #FF5630;">
                            <i class="fas fa-exclamation-circle" style="font-size: 48px; margin-bottom: 16px;"></i>
                            <div>${result.message || 'Âä†ËΩΩÂ§±Ë¥•'}</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Âä†ËΩΩÂÆ¢Êà∑ÂàóË°®Â§±Ë¥•:', error);
                content.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #FF5630;">
                        <i class="fas fa-exclamation-circle" style="font-size: 48px; margin-bottom: 16px;"></i>
                        <div>Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑ÈáçËØï</div>
                    </div>
                `;
            }
        }

        // ÈÄöÁî®Ê∏≤ÊüìÂÆ¢Êà∑ÂàóË°®ÂáΩÊï∞ÔºàÂ§çÁî®showCustomersByTagÁöÑÊ∏≤ÊüìÈÄªËæëÔºâ
        function renderCustomerList(data, filterType, filterValue) {
            const content = document.getElementById('customer-list-content');
            const customers = data.customers;
            const total = data.total;
            const totalPages = data.total_pages;
            const currentPage = data.page;
            
            if (customers.length === 0) {
                content.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #637381;">
                        <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                        <div>ÊöÇÊó†ÂÆ¢Êà∑Êï∞ÊçÆ</div>
                    </div>
                `;
                document.getElementById('customer-modal-pagination').innerHTML = '';
                return;
            }
            
            // ‰ΩøÁî®‰∏é showCustomersByTag Áõ∏ÂêåÁöÑË°®Ê†ºÊ∏≤ÊüìÈÄªËæë
            let html = `
                <table style="width: 100%; border-collapse: separate; border-spacing: 0 8px;">
                    <thead>
                        <tr style="background: #F4F6F8;">
                            <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #637381; border-radius: 8px 0 0 8px;">ÂÆ¢Êà∑Â§¥ÂÉè</th>
                            <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #637381;">Áî®Êà∑ÊòµÁß∞</th>
                            <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #637381;">Áî®Êà∑Â§áÊ≥®</th>
                            <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #637381;">ÊâÄÂ±ûÂëòÂ∑•</th>
                            <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #637381;">ÊâÄÂ±ûÁæ§</th>
                            <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #637381;">ÊÄßÂà´</th>
                            <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #637381;">ÂÆ¢Êà∑Ê†áÁ≠æ</th>
                            <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #637381; border-radius: 0 8px 8px 0;">Ê∑ªÂä†Êó∂Èó¥</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            customers.forEach((customer, index) => {
                const genderText = customer.gender === 1 ? 'Áî∑' : customer.gender === 2 ? 'Â•≥' : 'Êú™Áü•';
                const genderIcon = customer.gender === 1 ? '<i class="fas fa-mars" style="color: #00B8D9; margin-left: 4px;"></i>' : 
                                  customer.gender === 2 ? '<i class="fas fa-venus" style="color: #FF5630; margin-left: 4px;"></i>' : 
                                  '<i class="fas fa-genderless" style="color: #637381; margin-left: 4px;"></i>';
                
                const addTime = customer.add_time ? new Date(customer.add_time * 1000).toLocaleString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit' }) : '-';
                
                // Â§ÑÁêÜÊ†áÁ≠æÊï∞ÊçÆÔºöÊîØÊåÅ tags Êàñ enterprise_tags
                let customerTags = [];
                if (customer.tags && Array.isArray(customer.tags)) {
                    customerTags = customer.tags;
                } else if (customer.enterprise_tags && Array.isArray(customer.enterprise_tags)) {
                    customerTags = customer.enterprise_tags.map(t => t.tag_name || t.name || t);
                }
                
                const tags = customerTags.slice(0, 2).map(tag => 
                    `<span style="display: inline-block; padding: 2px 8px; background: rgba(0, 167, 111, 0.12); color: #005249; border-radius: 4px; font-size: 11px; margin-right: 4px; white-space: nowrap;">${tag}</span>`
                ).join('');
                
                const moreTags = customerTags.length > 2 ? `<span style="color: #637381; font-size: 11px;">+${customerTags.length - 2}</span>` : '';
                
                html += `
                    <tr style="background: #FFFFFF; border: 1px solid rgba(145, 158, 171, 0.12); transition: all 0.2s;" 
                        onmouseover="this.style.background='#F4F6F8'; this.style.boxShadow='0 0 2px 0 rgba(145, 158, 171, 0.2), 0 4px 8px rgba(145, 158, 171, 0.12)'" 
                        onmouseout="this.style.background='#FFFFFF'; this.style.boxShadow='none'">
                        <td style="padding: 12px 16px; border-radius: 8px 0 0 8px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, rgba(0, 184, 217, 0.2) 0%, rgba(0, 184, 217, 0.1) 100%); display: flex; align-items: center; justify-content: center; font-size: 18px; color: #00B8D9;">
                                <i class="fas fa-user"></i>
                            </div>
                        </td>
                        <td style="padding: 12px 16px;">
                            <div style="font-size: 14px; font-weight: 600; color: #212B36;">${customer.name || '-'}</div>
                        </td>
                        <td style="padding: 12px 16px;">
                            <div style="font-size: 13px; color: #637381;">${customer.remark || '-'}</div>
                        </td>
                        <td style="padding: 12px 16px;">
                            <div style="font-size: 13px; color: #212B36;">${customer.owner_name || customer.owner_userid || '-'}</div>
                        </td>
                        <td style="padding: 12px 16px;">
                            <div style="font-size: 13px; color: #637381;">-</div>
                        </td>
                        <td style="padding: 12px 16px;">
                            <div style="font-size: 13px; color: #212B36; display: flex; align-items: center;">
                                ${genderText}${genderIcon}
                            </div>
                        </td>
                        <td style="padding: 12px 16px;">
                            <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 4px;">
                                ${tags}
                                ${moreTags}
                            </div>
                        </td>
                        <td style="padding: 12px 16px; border-radius: 0 8px 8px 0;">
                            <div style="font-size: 12px; color: #637381; white-space: nowrap;">${addTime}</div>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            content.innerHTML = html;
            
            // Êõ¥Êñ∞ÂàÜÈ°µ
            const paginationContainer = document.getElementById('customer-modal-pagination');
            let paginationHtml = `
                <div style="display: flex; align-items: center; gap: 16px;">
                    <span style="font-size: 14px; color: #637381;">ÂÖ± ${total} ‰ΩçÂÆ¢Êà∑</span>
                    <div style="display: flex; align-items: center; gap: 8px;">
            `;
            
            // Ê†πÊçÆ filterType ÁîüÊàê‰∏çÂêåÁöÑÂàÜÈ°µÊåâÈíÆ
            if (filterType === 'province') {
                paginationHtml += `
                    <button onclick="showCustomersByProvince('${filterValue}', ${currentPage - 1})" 
                            ${currentPage === 1 ? 'disabled' : ''}
                            style="padding: 6px 12px; border: 1px solid rgba(145, 158, 171, 0.24); border-radius: 6px; background: white; color: #637381; font-size: 13px; cursor: pointer; transition: all 0.2s;"
                            ${currentPage === 1 ? '' : 'onmouseover="this.style.background=\'#F4F6F8\'" onmouseout="this.style.background=\'white\'"'}>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span style="font-size: 13px; color: #212B36; font-weight: 600;">${currentPage} / ${totalPages}</span>
                    <button onclick="showCustomersByProvince('${filterValue}', ${currentPage + 1})" 
                            ${currentPage >= totalPages ? 'disabled' : ''}
                            style="padding: 6px 12px; border: 1px solid rgba(145, 158, 171, 0.24); border-radius: 6px; background: white; color: #637381; font-size: 13px; cursor: pointer; transition: all 0.2s;"
                            ${currentPage >= totalPages ? '' : 'onmouseover="this.style.background=\'#F4F6F8\'" onmouseout="this.style.background=\'white\'"'}>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                `;
            } else if (filterType === 'add_way') {
                paginationHtml += `
                    <button onclick="showCustomersByAddWay('${filterValue}', ${currentPage - 1})" 
                            ${currentPage === 1 ? 'disabled' : ''}
                            style="padding: 6px 12px; border: 1px solid rgba(145, 158, 171, 0.24); border-radius: 6px; background: white; color: #637381; font-size: 13px; cursor: pointer; transition: all 0.2s;"
                            ${currentPage === 1 ? '' : 'onmouseover="this.style.background=\'#F4F6F8\'" onmouseout="this.style.background=\'white\'"'}>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span style="font-size: 13px; color: #212B36; font-weight: 600;">${currentPage} / ${totalPages}</span>
                    <button onclick="showCustomersByAddWay('${filterValue}', ${currentPage + 1})" 
                            ${currentPage >= totalPages ? 'disabled' : ''}
                            style="padding: 6px 12px; border: 1px solid rgba(145, 158, 171, 0.24); border-radius: 6px; background: white; color: #637381; font-size: 13px; cursor: pointer; transition: all 0.2s;"
                            ${currentPage >= totalPages ? '' : 'onmouseover="this.style.background=\'#F4F6F8\'" onmouseout="this.style.background=\'white\'"'}>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                `;
            } else if (filterType === 'gender') {
                paginationHtml += `
                    <button onclick="showCustomersByGender('${filterValue}', ${currentPage - 1})" 
                            ${currentPage === 1 ? 'disabled' : ''}
                            style="padding: 6px 12px; border: 1px solid rgba(145, 158, 171, 0.24); border-radius: 6px; background: white; color: #637381; font-size: 13px; cursor: pointer; transition: all 0.2s;"
                            ${currentPage === 1 ? '' : 'onmouseover="this.style.background=\'#F4F6F8\'" onmouseout="this.style.background=\'white\'"'}>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span style="font-size: 13px; color: #212B36; font-weight: 600;">${currentPage} / ${totalPages}</span>
                    <button onclick="showCustomersByGender('${filterValue}', ${currentPage + 1})" 
                            ${currentPage >= totalPages ? 'disabled' : ''}
                            style="padding: 6px 12px; border: 1px solid rgba(145, 158, 171, 0.24); border-radius: 6px; background: white; color: #637381; font-size: 13px; cursor: pointer; transition: all 0.2s;"
                            ${currentPage >= totalPages ? '' : 'onmouseover="this.style.background=\'#F4F6F8\'" onmouseout="this.style.background=\'white\'"'}>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                `;
            }
            
            paginationHtml += `
                    </div>
                </div>
            `;
            
            paginationContainer.innerHTML = paginationHtml;
        }

        // ÁÇπÂáªÂºπÁ™óÂ§ñÈÉ®ÂÖ≥Èó≠
        window.addEventListener('click', (e) => {
            const modal = document.getElementById('customer-list-modal');
            if (e.target === modal) {
                closeCustomerModal();
            }
        });

        // ÁõëÂê¨ÂÆ¢Êà∑ÁîªÂÉèÊ®°ÂùóÂàáÊç¢
        document.addEventListener('DOMContentLoaded', () => {
            const navItems = document.querySelectorAll('.nav-item[data-module="customer-profile"]');
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    setTimeout(() => loadCustomerPortrait(), 200);
                });
            });
        });

        console.log('[ÂÆ¢Êà∑ÁîªÂÉè] Ê®°ÂùóÂä†ËΩΩÂÆåÊàê');
    </script>
    

</body>
</html>
